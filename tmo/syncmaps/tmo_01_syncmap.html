<!DOCTYPE HTML>
<html>
    <head>
        <title>finetuneas, an HTML interface for fine tuning aeneas sync maps</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
            html, body {
                margin:0;
                min-height:100%;
            }
            #container {
                text-align:center;
                min-height:100%;
                position:absolute;
            }
            button, label, input, select {
                margin:5px;
            }
            .tg {
                table-layout:fixed;
                width:100%;
                border-spacing:0;
                position:relative;
                direction:ltr;
                margin:100px 0;
            }
            .text {
                margin-right:auto;
                margin-left:auto;
                font-size:22px;
                line-height:125%;
                font-family:Tahoma, Geneva, sans-serif;
            }
            .td {
                vertical-align:middle;
            }
            .edit {
                text-align:right;
            }
            .time, .increase, .decrease {
                opacity:0.6;
                position:relative;
                margin:5px;
                font-size:140%;
                line-height:110%;
                cursor:pointer;
                font-weight:900;
                border-style:solid;
                border-color:#999;
                border-width:1px 3px;
                background-color:#333;
                color:#fff;
            }
            .time {
                padding:2px 5px 0px 5px;
                margin-right:50px;
            }
            .increase {
                padding:2px 8px 0px 8px;
            }
            .decrease {
                padding:0px 8px 2px 8px;
                bottom:2px;
                margin-right:15px;
            }
            .increase, .decrease, .time, #stop {
                -webkit-touch-callout:none;
                -webkit-user-select:none;
                -khtml-user-select:none;
                -moz-user-select:none;
                -ms-user-select:none;
                user-select:none;
            }
            a:hover {
                opacity:1;
            }
            td {
                text-align:center;
                height:80px;
            }
            #advancedcontrols{
                position:fixed;
                z-index:10;
                bottom:30px;
                left:25px;
                text-align:left;
                visibility:hidden;
            }
            #fileinput, #audioinput {
                position:relative;
                bottom:5px;
            }
            #step1, #step2, #fileinfo {
                text-align:center;
                margin:20px;
                font-size:24px;
                font-weight:900;
            }
            #directions {
                margin:50px auto 150px auto;
                font-size:24px;
                max-width:700px;
                border:1px solid black;
                padding:20px;
            }
            .normal {
                line-height:150%;
                font-size:20px;
                text-align:left;
                margin:15px 50px;
            }
            .note {
                font-size:16px;
                margin:15px 80px;
            }
            #audiocontrols {
                position:fixed;
                z-index:10;
                text-align:right;
                top:30px;
                left:25px;
                display:none;
                background-color:#fff;
            }
            #audioticker {
                color:dimgrey;
                font-size:14px;
            }
            #stop {
                font-size:10px;
                position:relative;
                bottom:2px;
                opacity:0.6;
                padding:0 6px 3px 6px;
                margin:2px;
                cursor:pointer;
                background-color:#333;
                color:#fff;
                font-weight:900;
                font-family:Tahoma, Geneva, sans-serif;
            }
            #stop:hover {
                opacity:1;
            }
            .footer {
                font-size:12px;
                text-align:center;
                position:absolute;
                bottom:10px;
                left:0;
                right:0;
            }
            .footer a {
                color:#555;
            }
        </style>
    </head>
    <body>
        <!-- BEGIN container -->
        <div id="container">
            <!-- BEGIN directions -->
            <div id="directions">
                <p class="heading"><b>finetuneas</b></p>
                <p class="normal"><b>1.</b> Before you start making adjustments, check several fragments at random to be sure that the sync map is mostly correct and it just needs fine tuning. If not, check your <i>aeneas</i> input files and parameters and run <i>aeneas</i> again.</p>
                <p class="normal"><b>2.</b> To check the begin time of each fragment, click on the corresponding text or timestamp. If necessary, use the <b>+</b> and <b>−</b> buttons to adjust it.</p>
                <p class="normal"><b>3.</b> When done, you can save the adjusted sync map to file. If the desired format is not available, choose JSON and then use the <i>aeneas.tools.convert_syncmap</i> tool to convert it.</p>

                <!-- BEGIN loadbuttons -->
                <!-- do not remove the next line -->
                <!-- AENEAS_REPLACE_COMMENT_BEGIN
                <div id="loadbuttons">
                    <p class="normal"><b>4.</b> To start working, select your audio and JSON files:</p>
                    <div id="step1">Audio file: <input type="file" id="audioinput" accept="audio/*" autocomplete="off"/></div>
                    <div id="fileinfo"></div>
                    <div id="step2">JSON file: <input type="file" id="fileinput" accept=".json" autocomplete="off"/></div>
                </div>
                AENEAS_REPLACE_COMMENT_END -->
                <!-- do not remove the line above -->
                <!-- END loadbuttons -->

                <!-- BEGIN loadauto -->
                <!-- do not remove the next line -->
                <!-- AENEAS_REPLACE_UNCOMMENT_BEGIN -->
                <div id="loadauto">
                    <button id="buttonAutoLoad">Got it, let's start!</button>
                </div>
                <!-- AENEAS_REPLACE_UNCOMMENT_END -->
                <!-- do not remove the line above -->
                <!-- END loadauto -->

            </div>
            <!-- END directions -->

            <!-- BEGIN player -->
            <div id="player"> 
                <audio id="audioplayer" src="" ontimeupdate="ticker(this.currentTime);"></audio>
            </div>
            <!-- END player -->

            <div id="audiocontrols" >
                <span id="audioticker"></span>
                <span id="playpause"><a id="stop">ıı</a></span>
            </div>

            <div id="fragments">
                <table id="tb" class="tg"></table>
            </div>

            <div id="advancedcontrols">
                <label for="timeStep" style="display:block">Time increment (s):</label>
                <input id="timeStep" type="number" min="0.010" step="0.010" value="0.100" style="display:block"/> 
                <label for="buttonShowID" style="display:block">Show ID:</label>
                <button id="buttonShowID" style="display:block">OFF</button>
                <label for="alignText" style="display:block">Text alignment:</label>
                <select name="alignText" id="alignText" style="display:block">
                    <option value="left">Left</option>
                    <option value="center" selected="selected">Center</option>
                    <option value="right">Right</option>
                    <option value="justify">Justify</option>
                </select>
                <hr style="display:block"/>
                <label for="playbackRate" style="display:block">Playback rate:</label>
                <input id="playbackRate" type="number" min="0.1" max="4.0" step="0.1" value="1.0" style="display:block"/> 
                <label for="buttonContinuousPlay">Continuous play:</label>
                <button id="buttonContinuousPlay" style="display:block">OFF</button>
                <label for="buttonTimeFormat" style="display:block">Time format:</label>
                <button id="buttonTimeFormat" style="display:block">DECIMAL</button>
                <label for="transitionOffset" style="display:block">Transition offset (s):</label>
                <input id="transitionOffset" type="number" min="0" max="0.400" step="0.010" value="0.100" style="display:block"/> 
                <hr style="display:block"/>
                <label for="outputFormat" style="display:block">Format:</label>
                <select name="outputFormat" id="outputFormat" style="display:block">
                    <option value="csv">CSV</option>
                    <option value="json" selected="selected">JSON</option>
                    <option value="smil">SMIL</option>
                    <option value="srt">SRT</option>
                    <option value="ssv">SSV</option>
                    <option value="ttml">TTML</option>
                    <option value="tsv">TSV</option>
                    <option value="txt">TXT</option>
                    <option value="vtt">VTT</option>
                    <option value="xml">XML</option>
                </select>
                <input id="smilAudioRef" style="display:none" type="text" placeholder="audio_ref"/>
                <input id="smilPageRef" style="display:none" type="text" placeholder="page_ref"/>
                <button id="download" style="display:block">Save</button>
            </div>

            <div class="footer">
                <a href="https://github.com/ozdefir/finetuneas">finetuneas v1.0.2</a><br/>© 2015 Firat Özdemir 
            </div>
        </div>
        <!-- END container -->

<!-- BEGIN script -->
<script type="text/javascript">
//
//
// global variables and constants
//
//
var fragments = [];
var currentIndex = 0;
var audioElement = document.getElementById("audioplayer");
var ainfo = "";
var cinfo = "";
var url;
var COMPLETED = "lightgreen";
var ACTIVE = "yellow";
var CLEAR = "";
var TRANSITION_TIMEOUT = 0.400;
//
//
// variables that can be modified by the user at runtime
//
//
// do not remove the following lines starting with AENEAS_REPLACE_
//
var timeStep = 0.1;
// AENEAS_REPLACE_TIME_STEP
var showID = false;
showID = true;
var alignText = "center";
alignText = "left"
var playbackRate = 1.0;
// AENEAS_REPLACE_PLAYBACK_RATE
var continuousPlay = false;
continuousPlay = true;
var timeFormatHHMMSSmmm = false;
timeFormatHHMMSSmmm = true;
var transitionOffset = 0.100;
// AENEAS_REPLACE_TRANSITION_OFFSET
var outputFormat = "json";
// AENEAS_REPLACE_OUTPUT_FORMAT
var audioref = "";
// AENEAS_REPLACE_SMIL_AUDIOREF
var pageref = "";
// AENEAS_REPLACE_SMIL_PAGEREF
//
// do not remove the lines above starting with AENEAS_REPLACE_
//
//
// BEGIN INIT CODE
//
//
bindEssentialListeners();
applyDefaults();
//
//
// END INIT CODE
//
//
function bindEssentialListeners() {
    try {
        document.getElementById("audioinput").addEventListener("change", buttonLoadAudio, false);
    } catch(e) {
        // pass
    }
    try {
        document.getElementById("fileinput").addEventListener("change", buttonLoadJSON, false);
    } catch(e) {
        // pass
    }
    try {
        document.getElementById("buttonAutoLoad").addEventListener("click", buttonAutoLoad, false);
    } catch(e) {
        // pass
    }
}
function applyDefaults() {
    try {
        document.getElementById("timeStep").value = timeStep;
        setButtonText("buttonShowID", showID, "ON", "OFF");
        document.getElementById("alignText").value = alignText;
        document.getElementById("playbackRate").value = playbackRate;
        setButtonText("buttonContinuousPlay", continuousPlay, "ON", "OFF");
        setButtonText("buttonTimeFormat", timeFormatHHMMSSmmm, "HH:MM:SS.mmm", "DECIMAL");
        document.getElementById("transitionOffset").value = transitionOffset;
        document.getElementById("outputFormat").value = outputFormat;
        document.getElementById("smilAudioRef").value = audioref;
        document.getElementById("smilPageRef").value = pageref;
        changeOutputFormat();
    } catch(e) {
        // pass
    }
}
function buttonAutoLoad() {
    // fake
    var audioFilePath = "file:///tmp/audio.mp3";
    // do not remove the next line
    audioFilePath = "file:///media/bigdisk/git_repos/trafikmaktordningen-audiobook/original_data/Trafikmaktordningen ljudbok/Trafikmaktordningen - Kapitel 1.mp3";
    // do not remove the line above
    loadAudio(audioFilePath);
   
    // fake
    fragments = [
      {"begin": "0.000",  "end": "2.680",  "id": "f000001", "language": "en", "lines": ["1"]}, 
      {"begin": "2.680",  "end": "5.880",  "id": "f000002", "language": "en", "lines": ["From fairest creatures we desire increase,"]}, 
      {"begin": "5.880",  "end": "9.240",  "id": "f000003", "language": "en", "lines": ["That thereby beauty's rose might never die,"]}, 
      {"begin": "9.240",  "end": "11.760", "id": "f000004", "language": "en", "lines": ["But as the riper should by time decease,"]},
      {"begin": "11.760", "end": "14.440", "id": "f000005", "language": "en", "lines": ["His tender heir might bear his memory:"]},
      {"begin": "14.440", "end": "18.560", "id": "f000006", "language": "en", "lines": ["But thou contracted to thine own bright eyes,"]},
      {"begin": "18.560", "end": "22.280", "id": "f000007", "language": "en", "lines": ["Feed'st thy light's flame with self-substantial fuel,"]},
      {"begin": "22.280", "end": "25.480", "id": "f000008", "language": "en", "lines": ["Making a famine where abundance lies,"]},
      {"begin": "25.480", "end": "31.200", "id": "f000009", "language": "en", "lines": ["Thy self thy foe, to thy sweet self too cruel:"]},
      {"begin": "31.200", "end": "34.400", "id": "f000010", "language": "en", "lines": ["Thou that art now the world's fresh ornament,"]},
      {"begin": "34.400", "end": "36.960", "id": "f000011", "language": "en", "lines": ["And only herald to the gaudy spring,"]},
      {"begin": "36.960", "end": "40.640", "id": "f000012", "language": "en", "lines": ["Within thine own bud buriest thy content,"]},
      {"begin": "40.640", "end": "43.640", "id": "f000013", "language": "en", "lines": ["And tender churl mak'st waste in niggarding:"]},
      {"begin": "43.640", "end": "48.120", "id": "f000014", "language": "en", "lines": ["Pity the world, or else this glutton be,"]},
      {"begin": "48.120", "end": "53.240", "id": "f000015", "language": "en", "lines": ["To eat the world's due, by the grave and thee."]}
    ];
    // do not remove the next line
    fragments = ({
 "fragments": [
  {
   "begin": "0.000", 
   "children": [], 
   "end": "9.320", 
   "id": "f000001", 
   "language": "swe", 
   "lines": [
    "TRAFIKMAKTORDNINGEN, av planka punkt nu."
   ]
  }, 
  {
   "begin": "9.320", 
   "children": [], 
   "end": "11.000", 
   "id": "f000002", 
   "language": "swe", 
   "lines": [
    "Kapitel 1."
   ]
  }, 
  {
   "begin": "11.000", 
   "children": [], 
   "end": "14.800", 
   "id": "f000003", 
   "language": "swe", 
   "lines": [
    "TRAFIKMAKTORDNINGEN"
   ]
  }, 
  {
   "begin": "14.800", 
   "children": [], 
   "end": "18.440", 
   "id": "f000004", 
   "language": "swe", 
   "lines": [
    "Mobilitet och klass \u00e4r t\u00e4tt sammanv\u00e4vda."
   ]
  }, 
  {
   "begin": "18.440", 
   "children": [], 
   "end": "39.200", 
   "id": "f000005", 
   "language": "swe", 
   "lines": [
    "Inte bara d\u00e4rf\u00f6r att m\u00f6jligheten till mobilitet h\u00e4nger samman med ekonomiska resurser, utan \u00e4ven f\u00f6r att ett samh\u00e4lle byggt efter dagens mobilitetsparadigm, det vi kallar automobilitet, direkt bidrar till \u00f6kade ekonomiska och sociala skillnader."
   ]
  }, 
  {
   "begin": "39.200", 
   "children": [], 
   "end": "47.080", 
   "id": "f000006", 
   "language": "swe", 
   "lines": [
    "Alla kan vid en f\u00f6rsta anblick se att ett samh\u00e4lle som prioriterar bilism gynnar bilister."
   ]
  }, 
  {
   "begin": "47.080", 
   "children": [], 
   "end": "55.080", 
   "id": "f000007", 
   "language": "swe", 
   "lines": [
    "Lika tydligt \u00e4r det att andelen vita, h\u00f6gavl\u00f6nade m\u00e4n \u00e4r \u00f6verrepresenterad bland bilister."
   ]
  }, 
  {
   "begin": "55.080", 
   "children": [], 
   "end": "69.120", 
   "id": "f000008", 
   "language": "swe", 
   "lines": [
    "Men ett samh\u00e4lle som prioriterar bilism, och ser evigt \u00f6kande mobilitet som ett n\u00e4rmast magiskt framg\u00e5ngsrecept, \u00f6kar \u00e4ven skillnaderna mellan sina inv\u00e5nare och sina olika delar p\u00e5 andra s\u00e4tt."
   ]
  }, 
  {
   "begin": "69.120", 
   "children": [], 
   "end": "86.680", 
   "id": "f000009", 
   "language": "swe", 
   "lines": [
    "Trafikmaktordningen \u00e4r en hierarki bland trafikslag, med bilen i toppen och kollektivtrafiken, fotg\u00e4ngarna och cyklisterna nederst, som tar sig uttryck i att dessa f\u00e4rdmedel tilldelas olika mycket resurser och plats."
   ]
  }, 
  {
   "begin": "86.680", 
   "children": [], 
   "end": "93.480", 
   "id": "f000010", 
   "language": "swe", 
   "lines": [
    "Med bilen \u00f6verst i trafikmaktordningen f\u00e5r vi ett samh\u00e4lle byggt p\u00e5 automobilitet."
   ]
  }, 
  {
   "begin": "93.480", 
   "children": [], 
   "end": "99.720", 
   "id": "f000011", 
   "language": "swe", 
   "lines": [
    "En v\u00e4rld d\u00e4r v\u00e5ra liv i orimligt stor utstr\u00e4ckning styrs av bilen."
   ]
  }, 
  {
   "begin": "99.720", 
   "children": [], 
   "end": "108.560", 
   "id": "f000012", 
   "language": "swe", 
   "lines": [
    "Den h\u00e4r boken \u00e4r skriven f\u00f6r att klarg\u00f6ra hur den r\u00e5dande trafikmaktordningen ser ut och vilka konsekvenser den f\u00e5r."
   ]
  }, 
  {
   "begin": "108.560", 
   "children": [], 
   "end": "120.360", 
   "id": "f000013", 
   "language": "swe", 
   "lines": [
    "Ett samh\u00e4lle byggt p\u00e5 automobilitet \u00e4r inte bara skadligt ur ett ekologiskt perspektiv, det leder \u00e4ven till ekonomisk och social segregering."
   ]
  }, 
  {
   "begin": "120.360", 
   "children": [], 
   "end": "137.520", 
   "id": "f000014", 
   "language": "swe", 
   "lines": [
    "Genom att belysa problemen med dagens trafikhierarki och skissa p\u00e5 ett annat s\u00e4tt att planera och hantera r\u00f6relse s\u00e5 tror och hoppas vi att vi ocks\u00e5 kan ge inspiration till l\u00f6sningar p\u00e5 andra samh\u00e4llsproblem."
   ]
  }, 
  {
   "begin": "137.520", 
   "children": [], 
   "end": "140.920", 
   "id": "f000015", 
   "language": "swe", 
   "lines": [
    "Bilismen st\u00e4ller oss mot varandra."
   ]
  }, 
  {
   "begin": "140.920", 
   "children": [], 
   "end": "146.760", 
   "id": "f000016", 
   "language": "swe", 
   "lines": [
    "Vem har inte upplevt k\u00e4nslan av att s\u00e4tta sig i en bil och helt pl\u00f6tsligt bli bilist?"
   ]
  }, 
  {
   "begin": "146.760", 
   "children": [], 
   "end": "157.640", 
   "id": "f000017", 
   "language": "swe", 
   "lines": [
    "Att s\u00e4tta sig i en bil verkar n\u00e4stan per automatik leda till ett egoistiskt beteende d\u00e4r alla f\u00f6rs\u00f6ker tj\u00e4na n\u00e5got p\u00e5 andras bekostnad."
   ]
  }, 
  {
   "begin": "157.640", 
   "children": [], 
   "end": "169.120", 
   "id": "f000018", 
   "language": "swe", 
   "lines": [
    "Att s\u00e4tta sig i en bil f\u00f6rvandlar ens medm\u00e4nniskor (andra bilister, cyklister, fotg\u00e4ngare och kollektivtrafikanter) till hinder."
   ]
  }, 
  {
   "begin": "169.120", 
   "children": [], 
   "end": "178.880", 
   "id": "f000019", 
   "language": "swe", 
   "lines": [
    "Vem kan inte, med handen p\u00e5 hj\u00e4rtat, k\u00e4nna igen sig i den aggressiva och konkurrerande sj\u00e4lviskheten som bilen framkallar hos en?"
   ]
  }, 
  {
   "begin": "178.880", 
   "children": [], 
   "end": "195.920", 
   "id": "f000020", 
   "language": "swe", 
   "lines": [
    "Eftersom vi inte tycker att ett s\u00e5dant beteende ska uppmuntras, och eftersom vi \u00e4r \u00f6vertygade om att man inte f\u00f6ds till bilist, utan att man blir det, anser vi att risken f\u00f6r att folk blir bilister m\u00e5ste minimeras."
   ]
  }, 
  {
   "begin": "195.920", 
   "children": [], 
   "end": "206.280", 
   "id": "f000021", 
   "language": "swe", 
   "lines": [
    "D\u00e4rf\u00f6r vill vi inte bara \u00e4ndra p\u00e5 trafikhierarkin och putta ner bilen till botten, utan vi vill ha ett samh\u00e4lle byggt p\u00e5 helt andra premisser."
   ]
  }, 
  {
   "begin": "206.280", 
   "children": [], 
   "end": "213.280", 
   "id": "f000022", 
   "language": "swe", 
   "lines": [
    "Ett samh\u00e4lle d\u00e4r ingen tvingas in i bilism, varken aktiv eller passiv s\u00e5dan."
   ]
  }, 
  {
   "begin": "213.280", 
   "children": [], 
   "end": "222.680", 
   "id": "f000023", 
   "language": "swe", 
   "lines": [
    "Ett samh\u00e4lle d\u00e4r m\u00e4nniskors tillg\u00e4nglighet till det de beh\u00f6ver f\u00f6r att tillfredsst\u00e4lla sina behov och beg\u00e4r s\u00e4tts i f\u00f6rsta rummet."
   ]
  }, 
  {
   "begin": "222.680", 
   "children": [], 
   "end": "226.600", 
   "id": "f000024", 
   "language": "swe", 
   "lines": [
    "Ett samh\u00e4lle vi bygger och lever tillsammans."
   ]
  }, 
  {
   "begin": "226.600", 
   "children": [], 
   "end": "232.400", 
   "id": "f000025", 
   "language": "swe", 
   "lines": [
    "Ett samh\u00e4lle av (lokal)samh\u00e4llen."
   ]
  }, 
  {
   "begin": "232.400", 
   "children": [], 
   "end": "235.520", 
   "id": "f000026", 
   "language": "swe", 
   "lines": [
    "Automobilitet"
   ]
  }, 
  {
   "begin": "235.520", 
   "children": [], 
   "end": "250.400", 
   "id": "f000027", 
   "language": "swe", 
   "lines": [
    "Automobilitet \u00e4r ett begrepp f\u00f6r att tolka och beskriva de institutioner och praktiker som organiserar, underst\u00f6djer och formar bilens r\u00f6relse genom och p\u00e5verkan p\u00e5 v\u00e5ra samh\u00e4llen."
   ]
  }, 
  {
   "begin": "250.400", 
   "children": [], 
   "end": "266.120", 
   "id": "f000028", 
   "language": "swe", 
   "lines": [
    "Samtidigt \u00e4r det ocks\u00e5 namnet p\u00e5 den diskurs som ger bilen legitimitet som samh\u00e4llets motor genom att sammankoppla den med frihet, framsteg, r\u00f6relse, individualitet och sj\u00e4lvst\u00e4ndighet."
   ]
  }, 
  {
   "begin": "266.120", 
   "children": [], 
   "end": "277.200", 
   "id": "f000029", 
   "language": "swe", 
   "lines": [
    "Automobilitet \u00e4r kort och gott en av de principiella socio-teknologiska institutioner genom vilken moderniteten organiseras."
   ]
  }, 
  {
   "begin": "277.200", 
   "children": [], 
   "end": "290.080", 
   "id": "f000030", 
   "language": "swe", 
   "lines": [
    "Automobilitet \u00e4r en sammans\u00e4ttning av orden autonomi och mobilitet, samt n\u00e5got av en ordvits d\u00e5 \u201dauto\u201d \u00e4ven kan l\u00e4sas som bil."
   ]
  }, 
  {
   "begin": "290.080", 
   "children": [], 
   "end": "300.560", 
   "id": "f000031", 
   "language": "swe", 
   "lines": [
    "H\u00e4r ska det dock fr\u00e4mst l\u00e4sas som autonomi och som ett begrepp f\u00f6r att beskriva v\u00e5rt samh\u00e4lles syn p\u00e5 mobilitet och autonomi."
   ]
  }, 
  {
   "begin": "300.560", 
   "children": [], 
   "end": "308.240", 
   "id": "f000032", 
   "language": "swe", 
   "lines": [
    "Du uppn\u00e5r sj\u00e4lvst\u00e4ndighet genom mobilitet, och mobilitet kan bara uppn\u00e5s sj\u00e4lvst\u00e4ndigt."
   ]
  }, 
  {
   "begin": "308.240", 
   "children": [], 
   "end": "325.960", 
   "id": "f000033", 
   "language": "swe", 
   "lines": [
    "Id\u00e9er starkt sammankopplade med den liberala ideologi d\u00e4r vi alla \u00e4r individer \u2013 fria att sj\u00e4lva v\u00e4lja v\u00e5ra v\u00e4gar och liv \u2013 som i sin mest extrema form f\u00f6rnekar sj\u00e4lva existensen av samh\u00e4llet."
   ]
  }, 
  {
   "begin": "325.960", 
   "children": [], 
   "end": "339.240", 
   "id": "f000034", 
   "language": "swe", 
   "lines": [
    "Men precis som id\u00e9n om den fria individen skapas och underh\u00e5lls av en viss samh\u00e4llsformation, kr\u00e4ver id\u00e9n om automobilitet en enorm samh\u00e4llelig produktion."
   ]
  }, 
  {
   "begin": "339.240", 
   "children": [], 
   "end": "346.440", 
   "id": "f000035", 
   "language": "swe", 
   "lines": [
    "Utan v\u00e4gar, bilindustri och oljeindustri kan sj\u00e4lvfallet ingen ta bilen."
   ]
  }, 
  {
   "begin": "346.440", 
   "children": [], 
   "end": "368.400", 
   "id": "f000036", 
   "language": "swe", 
   "lines": [
    "Automobilitet \u00e4r en sj\u00e4lvmots\u00e4gelse s\u00e5tillvida att bilister inte alls \u00e4r fria att v\u00e4lja sina egna v\u00e4gar, utan k\u00f6r p\u00e5 v\u00e4gar byggda och planerade av politiker, till och fr\u00e5n bost\u00e4der och arbetsplatser f\u00f6rlagda till specifika platser av politiska och ekonomiska sk\u00e4l."
   ]
  }, 
  {
   "begin": "368.400", 
   "children": [], 
   "end": "392.280", 
   "id": "f000037", 
   "language": "swe", 
   "lines": [
    "Det \u00e4r n\u00e4stan komiskt att bilen i s\u00e5 stor utstr\u00e4ckning har kommit att symbolisera nyckeln till frihet och individualitet \u2013 ja, rentav blivit n\u00e5got av den moderna liberalismens heliga graal \u2013 n\u00e4r den i sj\u00e4lva verket \u00e4r sammankopplad med en hel flora av offentliga och privata kontrolltekniker."
   ]
  }, 
  {
   "begin": "392.280", 
   "children": [], 
   "end": "399.560", 
   "id": "f000038", 
   "language": "swe", 
   "lines": [
    "F\u00f6r att bilsamh\u00e4llet \u00f6verhuvudtaget ska fungera kr\u00e4vs ett otal regleringsmekanismer:"
   ]
  }, 
  {
   "begin": "399.560", 
   "children": [], 
   "end": "420.640", 
   "id": "f000039", 
   "language": "swe", 
   "lines": [
    "hur snabbt du f\u00e5r \u00e5ka, vart du kan \u00e5ka, \u00e5t vilket h\u00e5ll du ska \u00e5ka, var du kan stanna, hur mycket din bil f\u00e5r sl\u00e4ppa ut och hur s\u00e4ker din bil m\u00e5ste vara \u2013 detta \u00e4r bara n\u00e5gra exempel p\u00e5 alla de regleringar som omg\u00e4rdar dig varje g\u00e5ng du s\u00e4tter dig i bilen."
   ]
  }, 
  {
   "begin": "420.640", 
   "children": [], 
   "end": "432.440", 
   "id": "f000040", 
   "language": "swe", 
   "lines": [
    "F\u00f6r att detta ska fungera beh\u00f6vs en stor kontrollapparat som disciplinerar s\u00e5v\u00e4l bilister som icke-bilister till att underkasta sig dessa regler."
   ]
  }, 
  {
   "begin": "432.440", 
   "children": [], 
   "end": "440.600", 
   "id": "f000041", 
   "language": "swe", 
   "lines": [
    "Friheten p\u00e5 v\u00e4gen har vuxit fram hand i hand med en f\u00f6rdjupning av kontrollen av r\u00f6relse."
   ]
  }, 
  {
   "begin": "440.600", 
   "children": [], 
   "end": "449.080", 
   "id": "f000042", 
   "language": "swe", 
   "lines": [
    "Den nuvarande regimen av automobilitet b\u00e4r p\u00e5 ett antal ol\u00f6sliga, inneboende och destruktiva tendenser."
   ]
  }, 
  {
   "begin": "449.080", 
   "children": [], 
   "end": "452.160", 
   "id": "f000043", 
   "language": "swe", 
   "lines": [
    "Massbilism \u00e4r tr\u00e4ngsel."
   ]
  }, 
  {
   "begin": "452.160", 
   "children": [], 
   "end": "466.920", 
   "id": "f000044", 
   "language": "swe", 
   "lines": [
    "Automobilitet bygger p\u00e5 att samh\u00e4llet underst\u00f6djer och uppmuntrar alla inv\u00e5nare att anv\u00e4nda bilen, men om alla g\u00f6r detta f\u00f6rvandlas automobiliteten snabbt till immobilitet."
   ]
  }, 
  {
   "begin": "466.920", 
   "children": [], 
   "end": "476.200", 
   "id": "f000045", 
   "language": "swe", 
   "lines": [
    "K\u00f6er, tr\u00e4ngsel och trafikstockningar \u00e4r inte bilsamh\u00e4llets avarter, utan dess logiska konsekvenser."
   ]
  }, 
  {
   "begin": "476.200", 
   "children": [], 
   "end": "479.920", 
   "id": "f000046", 
   "language": "swe", 
   "lines": [
    "Massbilismen \u00e4r sin egen v\u00e4rsta fiende."
   ]
  }, 
  {
   "begin": "479.920", 
   "children": [], 
   "end": "490.600", 
   "id": "f000047", 
   "language": "swe", 
   "lines": [
    "Bilistens frihet f\u00f6ruts\u00e4tter massbilism, samtidigt som massbilismen om\u00f6jligg\u00f6r bilistens frihet."
   ]
  }, 
  {
   "begin": "490.600", 
   "children": [], 
   "end": "492.400", 
   "id": "f000048", 
   "language": "swe", 
   "lines": [
    "Massbilism \u00e4r rovdrift."
   ]
  }, 
  {
   "begin": "492.400", 
   "children": [], 
   "end": "506.200", 
   "id": "f000049", 
   "language": "swe", 
   "lines": [
    "V\u00e5rt klimat, v\u00e5ra naturresurser, vi sj\u00e4lva, v\u00e5ra st\u00e4der, ja hela det geopolitiska systemet har drabbats av akuta kriser p\u00e5 grund av massbilismen."
   ]
  }, 
  {
   "begin": "506.200", 
   "children": [], 
   "end": "519.760", 
   "id": "f000050", 
   "language": "swe", 
   "lines": [
    "Klimatf\u00f6r\u00e4ndringarna skenar i takt med motorernas brummande, v\u00e5ra st\u00e4der \u00e4ts upp av bilar och l\u00e4mnar mindre och mindre plats \u00e5t oss som bebor dem."
   ]
  }, 
  {
   "begin": "519.760", 
   "children": [], 
   "end": "531.760", 
   "id": "f000051", 
   "language": "swe", 
   "lines": [
    "Den \u00e4ndliga oljeproduktionen och oljekr\u00f6net genererar geopolitiska kriser, och till och med krig, f\u00f6r att uppr\u00e4tth\u00e5lla tillg\u00e5ngen p\u00e5 billig olja."
   ]
  }, 
  {
   "begin": "531.760", 
   "children": [], 
   "end": "542.680", 
   "id": "f000052", 
   "language": "swe", 
   "lines": [
    "F\u00f6r att inte tala om de \u00f6ver en komma tv\u00e5 miljoner m\u00e4nniskor som varje \u00e5r d\u00f6r som en direkt f\u00f6ljd av bilolyckor."
   ]
  }, 
  {
   "begin": "542.680", 
   "children": [], 
   "end": "553.360", 
   "id": "f000053", 
   "language": "swe", 
   "lines": [
    "Det \u00e4r viktigt att f\u00f6rst\u00e5 att de ovan n\u00e4mnda problemen med massbilismen inte \u00e4r n\u00e5gra tillf\u00e4lliga st\u00f6rningar i ett annars v\u00e4lfungerande system."
   ]
  }, 
  {
   "begin": "553.360", 
   "children": [], 
   "end": "556.120", 
   "id": "f000054", 
   "language": "swe", 
   "lines": [
    "Det \u00e4r n\u00e4mligen precis tv\u00e4rtom:"
   ]
  }, 
  {
   "begin": "556.120", 
   "children": [], 
   "end": "558.400", 
   "id": "f000055", 
   "language": "swe", 
   "lines": [
    "detta \u00e4r systemets normalitet."
   ]
  }, 
  {
   "begin": "558.400", 
   "children": [], 
   "end": "569.280", 
   "id": "f000056", 
   "language": "swe", 
   "lines": [
    "V\u00e5ra v\u00e4gar och bilar, som \u00e4r byggda f\u00f6r att fr\u00e4mja automobilitet, d\u00f6dar \u00f6ver tretusen m\u00e4nniskor varje dag."
   ]
  }, 
  {
   "begin": "569.280", 
   "children": [], 
   "end": "576.080", 
   "id": "f000057", 
   "language": "swe", 
   "lines": [
    "Men n\u00e4r h\u00f6rde du senast n\u00e5gon makthavare kritisera massbilismen som system?"
   ]
  }, 
  {
   "begin": "576.080", 
   "children": [], 
   "end": "584.280", 
   "id": "f000058", 
   "language": "swe", 
   "lines": [
    "Att n\u00e5gon skulle drista sig till att f\u00f6rklara krig mot bilismen ter sig i dagens politiska klimat fullst\u00e4ndigt osannolikt."
   ]
  }, 
  {
   "begin": "584.280", 
   "children": [], 
   "end": "587.640", 
   "id": "f000059", 
   "language": "swe", 
   "lines": [
    "Visst, i Sverige har vi \u201dnollvisionen\u201d:"
   ]
  }, 
  {
   "begin": "587.640", 
   "children": [], 
   "end": "597.720", 
   "id": "f000060", 
   "language": "swe", 
   "lines": [
    "en pappersprodukt som f\u00f6rs\u00f6ker r\u00e5da bot p\u00e5 massbilismens symptom utan att ens v\u00e5ga diskutera dess orsaker."
   ]
  }, 
  {
   "begin": "597.720", 
   "children": [], 
   "end": "610.720", 
   "id": "f000061", 
   "language": "swe", 
   "lines": [
    "Bild\u00f6den tolkas uppenbarligen inte som ett politiskt problem, snarare r\u00e5der det en total resignation inf\u00f6r dessa m\u00f6rdarmaskiner som alltmer tar \u00f6ver v\u00e5r planet."
   ]
  }, 
  {
   "begin": "610.720", 
   "children": [], 
   "end": "620.840", 
   "id": "f000062", 
   "language": "swe", 
   "lines": [
    "Det \u00e4r tydligt att automobilitet inte \u00e4r ett i praktiken rationellt och fungerande system f\u00f6r organisering av r\u00f6relse."
   ]
  }, 
  {
   "begin": "620.840", 
   "children": [], 
   "end": "626.800", 
   "id": "f000063", 
   "language": "swe", 
   "lines": [
    "Men redan p\u00e5 ett konceptuellt plan \u00e4r det som system betraktat en om\u00f6jlighet."
   ]
  }, 
  {
   "begin": "626.800", 
   "children": [], 
   "end": "637.960", 
   "id": "f000064", 
   "language": "swe", 
   "lines": [
    "Det som framst\u00e4lls som ett medel f\u00f6r frihet och oberoende bygger i sj\u00e4lva verket p\u00e5 ett intrikat n\u00e4t av kontrollmekanismer."
   ]
  }, 
  {
   "begin": "637.960", 
   "children": [], 
   "end": "650.960", 
   "id": "f000065", 
   "language": "swe", 
   "lines": [
    "\u00c4ven om konceptet automobilitet \u00e4r starkt sammankopplat med massbilismen \u00e4r det viktigt att f\u00f6rst\u00e5 hur dessa tankar ocks\u00e5 p\u00e5verkar andra delar av v\u00e5r samh\u00e4llsplanering."
   ]
  }, 
  {
   "begin": "650.960", 
   "children": [], 
   "end": "665.000", 
   "id": "f000066", 
   "language": "swe", 
   "lines": [
    "Automobilitetsbegreppet utg\u00e5r fr\u00e5n en tolkning av bilsamh\u00e4llet, men kan och b\u00f6r \u00e4ven anv\u00e4ndas f\u00f6r att f\u00f6rst\u00e5 v\u00e5rt s\u00e4tt att t\u00e4nka p\u00e5 individen och hennes m\u00f6jligheter och r\u00e4ttigheter att f\u00f6rflytta sig."
   ]
  }, 
  {
   "begin": "665.000", 
   "children": [], 
   "end": "683.520", 
   "id": "f000067", 
   "language": "swe", 
   "lines": [
    "I v\u00e5rt samh\u00e4lle, som \u00e4r s\u00e5 bundet vid id\u00e9n om den fria och sj\u00e4lvst\u00e4ndiga (autonoma) individen, kan det vara sv\u00e5rt att se hur m\u00e5nga av v\u00e5ra f\u00f6rest\u00e4llningar som indirekt b\u00e4r denna id\u00e9s pr\u00e4gel."
   ]
  }, 
  {
   "begin": "683.520", 
   "children": [], 
   "end": "695.280", 
   "id": "f000068", 
   "language": "swe", 
   "lines": [
    "Detta g\u00f6r det \u00e4nnu viktigare f\u00f6r oss att f\u00f6rst\u00e5 trafikmaktordningen och applicera v\u00e5r kunskap om automobilitetsparadigmet p\u00e5 samh\u00e4llsplaneringen."
   ]
  }, 
  {
   "begin": "695.280", 
   "children": [], 
   "end": "713.120", 
   "id": "f000069", 
   "language": "swe", 
   "lines": [
    "Begreppet automobilitet \u00e4r, r\u00e4tt anv\u00e4nt, ett kraftfullt verktyg f\u00f6r att analysera samh\u00e4llet, och f\u00f6r att skapa f\u00f6rst\u00e5else f\u00f6r hur vi genom medveten samh\u00e4llsplanering kan f\u00f6ra en radikal milj\u00f6- och r\u00e4ttvisepolitik."
   ]
  }, 
  {
   "begin": "713.120", 
   "children": [], 
   "end": "729.880", 
   "id": "f000070", 
   "language": "swe", 
   "lines": [
    "F\u00f6r att med ett konkret och aktuellt exempel visa hur automobilitet kan anv\u00e4ndas som tolkningsverktyg kan vi titta p\u00e5 en l\u00f6sning som ofta f\u00f6rs fram som ett s\u00e4tt att minska transportsektorns klimatfarliga utsl\u00e4pp, n\u00e4mligen sp\u00e5rbilar."
   ]
  }, 
  {
   "begin": "729.880", 
   "children": [], 
   "end": "734.240", 
   "id": "f000071", 
   "language": "swe", 
   "lines": [
    "F\u00f6r att kort rekapitulera debatten kring sp\u00e5rbilar:"
   ]
  }, 
  {
   "begin": "734.240", 
   "children": [], 
   "end": "747.520", 
   "id": "f000072", 
   "language": "swe", 
   "lines": [
    "Vi ser ett problem, biltrafiken st\u00e5r f\u00f6r en st\u00e4ndigt v\u00e4xande del av v\u00e5ra globala utsl\u00e4pp och bidrar kraftigt till f\u00f6rslumningen av v\u00e5ra st\u00e4der."
   ]
  }, 
  {
   "begin": "747.520", 
   "children": [], 
   "end": "755.280", 
   "id": "f000073", 
   "language": "swe", 
   "lines": [
    "Motgiftet mot biltrafiken s\u00e4gs vara kollektivtrafiken, men hur ska vi f\u00e5 folk att anv\u00e4nda den?"
   ]
  }, 
  {
   "begin": "755.280", 
   "children": [], 
   "end": "771.360", 
   "id": "f000074", 
   "language": "swe", 
   "lines": [
    "En spontan reaktion \u00e4r ofta att f\u00f6r att f\u00e5 bukt med bilismen s\u00e5 ska vi anpassa kollektivtrafiken till bilistens behov \u2013 n\u00e4r det i sj\u00e4lva verket \u00e4r bilistens behov som \u00e4r problemet."
   ]
  }, 
  {
   "begin": "771.360", 
   "children": [], 
   "end": "782.000", 
   "id": "f000075", 
   "language": "swe", 
   "lines": [
    "Sp\u00e5rbilar kanske \u2013 med betoning p\u00e5 kanske \u2013 lockar en del bilister att st\u00e4lla bilen hemma, men f\u00f6r\u00e4ndrar de hur v\u00e5ra st\u00e4der \u00e4r uppbyggda?"
   ]
  }, 
  {
   "begin": "782.000", 
   "children": [], 
   "end": "785.520", 
   "id": "f000076", 
   "language": "swe", 
   "lines": [
    "Knappast!"
   ]
  }, 
  {
   "begin": "785.520", 
   "children": [], 
   "end": "800.360", 
   "id": "f000077", 
   "language": "swe", 
   "lines": [
    "Att sp\u00e5rbilsindustrin tillsammans med m\u00e5nga milj\u00f6partister och liberaler f\u00f6respr\u00e5kar sp\u00e5rbilar och d\u00e4rmed f\u00f6rst\u00e4rker id\u00e9n om automobilitet som n\u00e5gonting positivt \u00e4r inte s\u00e4rskilt f\u00f6rv\u00e5nande."
   ]
  }, 
  {
   "begin": "800.360", 
   "children": [], 
   "end": "809.520", 
   "id": "f000078", 
   "language": "swe", 
   "lines": [
    "Att frikoppla id\u00e9n om individen fr\u00e5n ett st\u00f6rre sammanhang \u2013 samh\u00e4llet \u2013 \u00e4r ett i grunden liberalt projekt."
   ]
  }, 
  {
   "begin": "809.520", 
   "children": [], 
   "end": "815.960", 
   "id": "f000079", 
   "language": "swe", 
   "lines": [
    "Ett projekt som f\u00f6rsv\u00e5rar m\u00f6jligheterna att t\u00e4nka kring och politisera mobiliteten."
   ]
  }, 
  {
   "begin": "815.960", 
   "children": [], 
   "end": "827.040", 
   "id": "f000080", 
   "language": "swe", 
   "lines": [
    "F\u00f6r trots att transporter upptar en s\u00e5 stor del av v\u00e5ra liv och v\u00e5r ekonomi f\u00f6rst\u00e5s de alltf\u00f6r s\u00e4llan som politiska."
   ]
  }, 
  {
   "begin": "827.040", 
   "children": [], 
   "end": "834.000", 
   "id": "f000081", 
   "language": "swe", 
   "lines": [
    "Ist\u00e4llet uppfattas de ofta som tekniska fr\u00e5gor, som problem f\u00f6r ingenj\u00f6rer att l\u00f6sa."
   ]
  }, 
  {
   "begin": "834.000", 
   "children": [], 
   "end": "853.320", 
   "id": "f000082", 
   "language": "swe", 
   "lines": [
    "Men mobilitetens politiska ekonomi \u00e4r t\u00e4tt knuten till br\u00e4nnheta fr\u00e5gor som stadens utveckling, klimat-, milj\u00f6-, och energikriser, r\u00e4ttvisa, j\u00e4mlikhet och j\u00e4mst\u00e4lldhet samt migration och kapitalackumulation."
   ]
  }, 
  {
   "begin": "853.320", 
   "children": [], 
   "end": "861.360", 
   "id": "f000083", 
   "language": "swe", 
   "lines": [
    "Trafikmaktordningen g\u00f6r inte bara skillnad p\u00e5 bil och buss, utan \u00e4ven p\u00e5 folk och folk."
   ]
  }, 
  {
   "begin": "861.360", 
   "children": [], 
   "end": "871.080", 
   "id": "f000084", 
   "language": "swe", 
   "lines": [
    "Fr\u00e5gan om hur vi strukturerar r\u00f6relse \u00e4r f\u00f6r viktig f\u00f6r att l\u00e4mnas \u00e5t experter, f\u00f6retag eller politiker."
   ]
  }, 
  {
   "begin": "871.080", 
   "children": [], 
   "end": "876.840", 
   "id": "f000085", 
   "language": "swe", 
   "lines": [
    "Den \u00e4r n\u00e5got vi beh\u00f6ver diskutera och besluta om kollektivt."
   ]
  }
 ]
}).fragments;
    // do not remove the line above
    roundTimeValues();
    prepareTable();
    prepareControls();
}
function buttonLoadAudio(evt) {
    var audioFile = evt.target.files[0];
    if (audioFile) {
        var audioFilePath = URL.createObjectURL(audioFile);
        loadAudio(audioFilePath);
        ainfo = "[Audio file: \"" + audioFile.name + "\"]";
        document.getElementById("fileinfo").innerHTML = ainfo + " " + cinfo;
        document.getElementById("step1").style.display = "none";
    } else {
        alert("Failed to load the audio file.");
    }
}
function loadAudio(audioFilePath) {
    audioElement.setAttribute("src", audioFilePath);
}
function buttonLoadJSON(evt) {
     var jsonFile = evt.target.files[0];
     if (jsonFile) {
        loadJSON(jsonFile);
     } else {
        alert("Failed to load the JSON file.");
     }
}
function loadJSON(jsonFile) {
    var reader = new FileReader();
    reader.onload = function(e) { 
        try {
            fragments = JSON.parse(e.target.result).fragments;
        } catch (e) {
            alert("Unable to parse the given JSON file.");
            return;
        }
        roundTimeValues();
        prepareTable();
        prepareControls();
        cinfo = "[JSON file: \"" + jsonFile.name + "\"]";
        document.getElementById("step2").style.display = "none";
        document.getElementById("fileinfo").innerHTML = ainfo + " " + cinfo;
    }
    reader.readAsText(jsonFile);
}   
function prepareControls() {
    // add event listeners
    for (var i = 0; i < fragments.length; i++) {
        if (showID) {
            document.getElementById(getStringID(i, "id")).addEventListener("click", fragmentClick);
        }
        document.getElementById(getStringID(i, "cell")).addEventListener("click", fragmentClick);
        document.getElementById(getStringID(i, "text")).addEventListener("click", fragmentClick);
        document.getElementById(getStringID(i, "time")).addEventListener("click", fragmentClick);
        document.getElementById(getStringID(i, "increase")).addEventListener("click", increaseClick);
        document.getElementById(getStringID(i, "decrease")).addEventListener("click", decreaseClick);
    }
    document.getElementById("stop").addEventListener("click", stopOverlay);
    document.getElementById("buttonShowID").addEventListener("click", changeShowID);
    document.getElementById("alignText").addEventListener("change", changeAlignText);
    document.getElementById("buttonContinuousPlay").addEventListener("click", changeContinuousPlay);
    document.getElementById("buttonTimeFormat").addEventListener("click", changeTimeFormat);
    document.getElementById("timeStep").addEventListener("change", changeTimeStep);
    document.getElementById("transitionOffset").addEventListener("change", changeTransitionOffset);
    document.getElementById("playbackRate").addEventListener("change", changePlaybackRate);
    document.getElementById("outputFormat").addEventListener("change", changeOutputFormat, false);
    document.getElementById("download").addEventListener("click", downloadClick);
    document.getElementById("advancedcontrols").style.visibility = "visible";
}
function changeShowID() {
    showID = !showID;
    setButtonText("buttonShowID", showID, "ON", "OFF");
    prepareTable();
    prepareControls();
}
function changeAlignText() {
    alignText = document.getElementById("alignText").value;
    applyAlignment();
}
function applyAlignment() {
    for (var i = 0; i < fragments.length; i++) {
        document.getElementById(getStringID(i, "cell")).style.textAlign = alignText;
    }
}
function changeOutputFormat() {
    var outputFormat = document.getElementById("outputFormat").value;
    var disp = "none";
    if (outputFormat == "smil") {
        disp = "block";
    }
    document.getElementById("smilAudioRef").style.display = disp;
    document.getElementById("smilPageRef").style.display = disp;
}
function changeTimeStep() {
    timeStep = parseFloat(document.getElementById("timeStep").value);
}
function changeTransitionOffset() {
    transitionOffset = parseFloat(document.getElementById("transitionOffset").value);
}
function changePlaybackRate() {
    audioElement.playbackRate = parseFloat(document.getElementById("playbackRate").value);
}
function changeContinuousPlay() {
    continuousPlay = !continuousPlay;
    setButtonText("buttonContinuousPlay", continuousPlay, "ON", "OFF");
}
function changeTimeFormat() {
    timeFormatHHMMSSmmm = !timeFormatHHMMSSmmm;
    setButtonText("buttonTimeFormat", timeFormatHHMMSSmmm, "HH:MM:SS.mmm", "DECIMAL");
    updateTime();
}
function setButtonText(element, variable, true_text, false_text) {
    var text = false_text;
    if (variable) {
        text = true_text;
    }
    document.getElementById(element).innerHTML = text;
}
function updateTime(i) {
    if (i == null) {
        for (var i = 0; i < fragments.length; i++) {
            var begin = fragments[i].begin;
            document.getElementById(getStringID(i, "time")).innerHTML =  formatTime(begin);
        }
    } else {
        var begin = fragments[i].begin;
        document.getElementById(getStringID(i, "time")).innerHTML =  formatTime(begin);
    }
}
function formatTime(time_value) {
    if (timeFormatHHMMSSmmm) {
        return timeHHMMSSmmm(time_value, ".");
    }
    return time_value.toFixed(3);
}
function getStringID(i, element) {
    if (element == "id") {
        return ("id" + i);
    }
    if (element == "cell") {
        return ("c" + i);
    }
    if (element == "text") {
        return ("f" + i);
    }
    if (element == "time") {
        return ("t" + i);
    }
    if (element == "increase") {
        return ("t" + i + "inc");
    }
    if (element == "decrease") {
        return ("t" + i + "dec");
    }
    return ("" + i);
}
function getID(idstring) {
    var s = idstring;
    s = s.replace("inc", "");
    s = s.replace("dec", "");
    s = s.replace("id", "");
    s = s.replace("c", "");
    s = s.replace("t", "");
    s = s.replace("f", "");
    return parseInt(s);
}
function roundTimeValues() {
    for (var i = 0; i < fragments.length; i++) {
        fragments[i].begin = roundTimeValue(fragments[i].begin);
        fragments[i].end = roundTimeValue(fragments[i].end);
    }
}
function prepareTable() {
    var rows = [];
    for (var i = 0; i < fragments.length; ++i) {
        var id = fragments[i].id;
        var text = fragments[i].lines.join("<br/>");
        var begin = fragments[i].begin;
        var end = fragments[i].end;
        var row = "";
        row += "<tr>";
        row += "<\/tr>";
        row += "<td><\/td>";
        if (showID) {
            row += '<td id="' + getStringID(i, "id") + '">' + id + '<\/td>';
        }
        row += '<td id="' + getStringID(i, "cell") + '"><a class="text" id="' + getStringID(i, "text") + '">' + text + '<\/a><\/td>';
        row += '<td class="edit">';
        row += '<a class="time" id="' + getStringID(i, "time") + '">' + formatTime(begin) + '<\/a>';
        row += '<a class="increase" id="' + getStringID(i, "increase") + '">+<\/a>';
        row += '<a class="decrease" id="' + getStringID(i, "decrease") + '">−<\/a>';
        row += "<\/td>";
        row += "<\/tr>";
        rows[i] = row;
    }
    var colID = "";
    if (showID) {
        colID = '<col width="100">';
    }
    document.getElementById("tb").innerHTML = '<col width="250px">' + colID + '<col><col width="300px"><tbody>' + rows.join("") + "<\/tbody>";
    applyAlignment();
}
function roundTimeValue(time) {
    return Math.round(time * 1000) / 1000;
}
function highlight(style) {
    try {
        document.getElementById(getStringID(currentIndex, "cell")).style.backgroundColor = style;
    } catch (e) {
        // pass 
    }
}
function fragmentClick(evt) {
    highlight(CLEAR);
    currentIndex = getID(evt.target.id);
    playOverlay(0);
}
function increaseClick(evt) {
    changeTime(evt, timeStep);
}
function decreaseClick(evt) {
    changeTime(evt, -timeStep);
}
function changeTime(evt, step) {
    var i = getID(evt.target.id);
    fragments[i].begin = roundTimeValue(fragments[i].begin + step);
    if (fragments[i].begin < 0) {
        fragments[i].begin = 0.00;
    }
    if (i > 0) {
        fragments[i-1].end = fragments[i].begin;
    }
    updateTime(i);
    highlight(CLEAR);
    currentIndex = i;
    playOverlay(0);
}
function downloadData() {
    var aElement = document.createElement("a");
    aElement.style = "display: none";
    document.body.appendChild(aElement);
    return function (data, fileName) {
        blob = new Blob([data], { type: "octet/stream" }),
        url = window.URL.createObjectURL(blob);
        aElement.href = url;
        aElement.download = fileName;
        aElement.click();
    };
}
function triggerDownload(data, fileName) {
    setTimeout(function() {
        var df = downloadData();
        df(data, fileName);
    }, 500);
    window.URL.revokeObjectURL(url);
}
function downloadClick() {
    var outputFormat = document.getElementById("outputFormat").value;
    var data = null;
    switch(outputFormat) {
        case "csv":
            data = downloadCSV();
            break;
        case "json":
            data = downloadJSON();
            break;
        case "smil":
            data = downloadSMIL();
            break;
        case "srt":
            data = downloadSRT();
            break;
        case "ssv":
            data = downloadSSV();
            break;
        case "ttml":
            data = downloadTTML();
            break;
        case "tsv":
            data = downloadTSV();
            break;
        case "txt":
            data = downloadTXT();
            break;
        case "vtt":
            data = downloadVTT();
            break;
        case "xml":
            data = downloadXML();
            break;
        default:
            data = downloadJSON();
    }
    var message = "The modified " + outputFormat.toUpperCase() + " file will be saved in your default Download directory. Please enter a file name:";
    var suggestedFileName = "tuned." + outputFormat;
    var fileName = prompt(message, suggestedFileName);
    triggerDownload(data, fileName);
}
function downloadCSV() {
    var lines = [];
    for (var i = 0; i < fragments.length; ++i) {
        lines[i] = fragments[i].id + "," + fragments[i].begin + "," + fragments[i].end + ',"' + fragments[i].lines.join(" ") + '"';
    };
    return lines.join("\n");
}
function downloadJSON() {
    var jsonData = {};
    jsonData.fragments = fragments;
    // convert the numbers to strings (as in the original JSON)
    function numberToString(key, value) {
        if (typeof value === "number") {
            value = value.toString();
        }
        return value;
    }
    return JSON.stringify(jsonData, numberToString, " ");
}
function downloadSMIL() {
    var audioref = document.getElementById("smilAudioRef").value;
    var pageref = document.getElementById("smilPageRef").value;
    var lines = [];
    var j = 0;
    lines[j++] = '<smil xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/ns/SMIL" version="3.0">';
    lines[j++] = '  <body>';
    lines[j++] = '    <seq id="s000001" epub:textref="' + pageref + '">';
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = '      <par id="p' + pad(i+1, 6) + '">';
        lines[j++] = '        <text src="' + pageref + '#' + fragments[i].id + '"/>';
        lines[j++] = '        <audio src="' + audioref + '" clipBegin="' + timeSMIL(fragments[i].begin) + '" clipEnd="' + timeSMIL(fragments[i].end)+ '"/>';
        lines[j++] = '      <\/par>';
    };
    lines[j++] = '    <\/seq>';
    lines[j++] = '  <\/body>';
    lines[j++] = '<\/smil>';
    return lines.join("\n");
}
function downloadSRT() {
    var lines = [];
    var j = 0;
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = "" + (i+1);
        lines[j++] = timeSRT(fragments[i].begin) + " --> " + timeSRT(fragments[i].end);
        var f_lines = fragments[i].lines;
        for (var k = 0; k < f_lines.length; ++k) {
            lines[j++] = f_lines[k];
        }
        lines[j++] = ""
    };
    return lines.join("\n") + "\n";
}
function downloadSSV() {
    var lines = [];
    for (var i = 0; i < fragments.length; ++i) {
        lines[i] = fragments[i].begin + " " + fragments[i].end + " " + fragments[i].id + ' "' + fragments[i].lines.join(" ") + '"';
    };
    return lines.join("\n");
}
function downloadTTML() {
    var lines = [];
    var j = 0;
    lines[j++] = "<?xml version='1.0' encoding='UTF-8'?>";
    lines[j++] = '<tt xmlns="http://www.w3.org/ns/ttml" xml:lang="">';
    lines[j++] = '  <body>';
    lines[j++] = '    <div>';
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = '      <p xml:id="' + fragments[i].id + '" begin="' + fragments[i].begin + 's" end="' + fragments[i].end + 's">' + fragments[i].lines.join("<br/>") + '<\/p>';
    };
    lines[j++] = '    <\/div>';
    lines[j++] = '  <\/body>';
    lines[j++] = '<\/tt>';
    return lines.join("\n");
}
function downloadTSV() {
    var lines = [];
    for (var i = 0; i < fragments.length; ++i) {
        lines[i] = fragments[i].begin + "\t" + fragments[i].end + "\t" + fragments[i].id;
    };
    return lines.join("\n");
}
function downloadTXT() {
    var lines = [];
    for (var i = 0; i < fragments.length; ++i) {
        lines[i] = fragments[i].id + " " + fragments[i].begin + " " + fragments[i].end + ' "' + fragments[i].lines.join(" ") + '"';
    };
    return lines.join("\n");
}
function downloadVTT() {
    var lines = [];
    var j = 0;
    lines[j++] = "WEBVTT\n"
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = "" + (i+1);
        lines[j++] = timeVTT(fragments[i].begin) + " --> " + timeVTT(fragments[i].end);
        var f_lines = fragments[i].lines;
        for (var k = 0; k < f_lines.length; ++k) {
            lines[j++] = f_lines[k];
        }
        lines[j++] = ""
    };
    return lines.join("\n") + "\n";
}
function downloadXML() {
    var lines = [];
    var j = 0;
    lines[j++] = "<?xml version='1.0' encoding='UTF-8'?>";
    lines[j++] = '<map>';
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = '  <fragment id="' + fragments[i].id + '" begin="' + fragments[i].begin + '" end="' + fragments[i].end + '">';
        var f_lines = fragments[i].lines;
        for (var k = 0; k < f_lines.length; ++k) {
            lines[j++] = '    <line>' + f_lines[k] + '<\/line>';
        }
        lines[j++] = '  <\/fragment>';
    };
    lines[j++] = '<\/map>';
    return lines.join("\n");
}
function pad(num, size) {
    var s = num + "";
    while (s.length < size) {
        s = "0" + s;
    }
    return s;
}
function timeHHMMSSmmm(time_value, decimal_separator) {
    var tmp = parseFloat(time_value);
    var hours = parseInt(Math.floor(tmp / 3600));
    tmp -= (hours * 3600);
    var minutes = parseInt(Math.floor(tmp / 60));
    tmp -= minutes * 60;
    var seconds = parseInt(Math.floor(tmp));
    tmp -= seconds;
    var milliseconds = parseInt(Math.floor(tmp * 1000));
    return pad(hours, 2) + ":" + pad(minutes, 2) + ":" + pad(seconds, 2) + decimal_separator + pad(milliseconds, 3); 
}
function timeSMIL(time_value) { 
    return timeHHMMSSmmm(time_value, ".");
}
function timeSRT(time_value) { 
    return timeHHMMSSmmm(time_value, ",");
}
function timeVTT(time_value) { 
    return timeHHMMSSmmm(time_value, ".");
}
function ticker(cTime){
    
    // TODO ALPE use a global stopwatch object
    
    // "timeupdate" alone isn't accurate enough
    // to pause exactly at the end of the fragment.
    // Another option is to use temporal dimensions
    // for audio source but Chrome doesn't support it with blobs.
    // If in the last TRANSITION_TIMEOUT seconds, calculate the time left,
    // and set a corresponding timeout to pause the fragment.
    if(cTime > fragments[currentIndex].end - TRANSITION_TIMEOUT) {
        // subtract transitionOffset seconds to account for the delay introduced by this code
        var timeLeft = (fragments[currentIndex].end - cTime - transitionOffset) * 1000 / audioElement.playbackRate;
        var index = currentIndex;
        setTimeout(function() {
            // do not perform action if the user
            // jumped to another fragment
            if (index == currentIndex) {
                if (continuousPlay) {
                    playOverlay(1);
                } else {
                    highlight(COMPLETED);
                    stopOverlay();
                }
            }
        }, timeLeft)
    }
    // display current time
    document.getElementById("audioticker").innerHTML = cTime.toFixed(3);
}
function stopOverlay() {
    audioElement.pause();
    document.getElementById("stop").style.display = "none";
}
function playOverlay(inc) {
    highlight(CLEAR);
    if (currentIndex + inc < fragments.length) { 
        currentIndex += inc;
        highlight(ACTIVE);
        audioElement.currentTime = fragments[currentIndex].begin;
        audioElement.play();
        document.getElementById("audiocontrols").style.display = "block";
        document.getElementById("stop").style.display = "inline";
    } else {
        stopOverlay();
    }
}   
</script>
<!-- END script -->

    </body>
</html>
