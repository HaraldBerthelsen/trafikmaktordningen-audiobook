<!DOCTYPE HTML>
<html>
    <head>
        <title>finetuneas, an HTML interface for fine tuning aeneas sync maps</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <style>
            html, body {
                margin:0;
                min-height:100%;
            }
            #container {
                text-align:center;
                min-height:100%;
                position:absolute;
            }
            button, label, input, select {
                margin:5px;
            }
            .tg {
                table-layout:fixed;
                width:100%;
                border-spacing:0;
                position:relative;
                direction:ltr;
                margin:100px 0;
            }
            .text {
                margin-right:auto;
                margin-left:auto;
                font-size:22px;
                line-height:125%;
                font-family:Tahoma, Geneva, sans-serif;
            }
            .td {
                vertical-align:middle;
            }
            .edit {
                text-align:right;
            }
            .time, .increase, .decrease {
                opacity:0.6;
                position:relative;
                margin:5px;
                font-size:140%;
                line-height:110%;
                cursor:pointer;
                font-weight:900;
                border-style:solid;
                border-color:#999;
                border-width:1px 3px;
                background-color:#333;
                color:#fff;
            }
            .time {
                padding:2px 5px 0px 5px;
                margin-right:50px;
            }
            .increase {
                padding:2px 8px 0px 8px;
            }
            .decrease {
                padding:0px 8px 2px 8px;
                bottom:2px;
                margin-right:15px;
            }
            .increase, .decrease, .time, #stop {
                -webkit-touch-callout:none;
                -webkit-user-select:none;
                -khtml-user-select:none;
                -moz-user-select:none;
                -ms-user-select:none;
                user-select:none;
            }
            a:hover {
                opacity:1;
            }
            td {
                text-align:center;
                height:80px;
            }
            #advancedcontrols{
                position:fixed;
                z-index:10;
                bottom:30px;
                left:25px;
                text-align:left;
                visibility:hidden;
            }
            #fileinput, #audioinput {
                position:relative;
                bottom:5px;
            }
            #step1, #step2, #fileinfo {
                text-align:center;
                margin:20px;
                font-size:24px;
                font-weight:900;
            }
            #directions {
                margin:50px auto 150px auto;
                font-size:24px;
                max-width:700px;
                border:1px solid black;
                padding:20px;
            }
            .normal {
                line-height:150%;
                font-size:20px;
                text-align:left;
                margin:15px 50px;
            }
            .note {
                font-size:16px;
                margin:15px 80px;
            }
            #audiocontrols {
                position:fixed;
                z-index:10;
                text-align:right;
                top:30px;
                left:25px;
                display:none;
                background-color:#fff;
            }
            #audioticker {
                color:dimgrey;
                font-size:14px;
            }
            #stop {
                font-size:10px;
                position:relative;
                bottom:2px;
                opacity:0.6;
                padding:0 6px 3px 6px;
                margin:2px;
                cursor:pointer;
                background-color:#333;
                color:#fff;
                font-weight:900;
                font-family:Tahoma, Geneva, sans-serif;
            }
            #stop:hover {
                opacity:1;
            }
            .footer {
                font-size:12px;
                text-align:center;
                position:absolute;
                bottom:10px;
                left:0;
                right:0;
            }
            .footer a {
                color:#555;
            }
        </style>
    </head>
    <body>
        <!-- BEGIN container -->
        <div id="container">
            <!-- BEGIN directions -->
            <div id="directions">
                <p class="heading"><b>finetuneas</b></p>
                <p class="normal"><b>1.</b> Before you start making adjustments, check several fragments at random to be sure that the sync map is mostly correct and it just needs fine tuning. If not, check your <i>aeneas</i> input files and parameters and run <i>aeneas</i> again.</p>
                <p class="normal"><b>2.</b> To check the begin time of each fragment, click on the corresponding text or timestamp. If necessary, use the <b>+</b> and <b>−</b> buttons to adjust it.</p>
                <p class="normal"><b>3.</b> When done, you can save the adjusted sync map to file. If the desired format is not available, choose JSON and then use the <i>aeneas.tools.convert_syncmap</i> tool to convert it.</p>

                <!-- BEGIN loadbuttons -->
                <!-- do not remove the next line -->
                <!-- AENEAS_REPLACE_COMMENT_BEGIN
                <div id="loadbuttons">
                    <p class="normal"><b>4.</b> To start working, select your audio and JSON files:</p>
                    <div id="step1">Audio file: <input type="file" id="audioinput" accept="audio/*" autocomplete="off"/></div>
                    <div id="fileinfo"></div>
                    <div id="step2">JSON file: <input type="file" id="fileinput" accept=".json" autocomplete="off"/></div>
                </div>
                AENEAS_REPLACE_COMMENT_END -->
                <!-- do not remove the line above -->
                <!-- END loadbuttons -->

                <!-- BEGIN loadauto -->
                <!-- do not remove the next line -->
                <!-- AENEAS_REPLACE_UNCOMMENT_BEGIN -->
                <div id="loadauto">
                    <button id="buttonAutoLoad">Got it, let's start!</button>
                </div>
                <!-- AENEAS_REPLACE_UNCOMMENT_END -->
                <!-- do not remove the line above -->
                <!-- END loadauto -->

            </div>
            <!-- END directions -->

            <!-- BEGIN player -->
            <div id="player"> 
                <audio id="audioplayer" src="" ontimeupdate="ticker(this.currentTime);"></audio>
            </div>
            <!-- END player -->

            <div id="audiocontrols" >
                <span id="audioticker"></span>
                <span id="playpause"><a id="stop">ıı</a></span>
            </div>

            <div id="fragments">
                <table id="tb" class="tg"></table>
            </div>

            <div id="advancedcontrols">
                <label for="timeStep" style="display:block">Time increment (s):</label>
                <input id="timeStep" type="number" min="0.010" step="0.010" value="0.100" style="display:block"/> 
                <label for="buttonShowID" style="display:block">Show ID:</label>
                <button id="buttonShowID" style="display:block">OFF</button>
                <label for="alignText" style="display:block">Text alignment:</label>
                <select name="alignText" id="alignText" style="display:block">
                    <option value="left">Left</option>
                    <option value="center" selected="selected">Center</option>
                    <option value="right">Right</option>
                    <option value="justify">Justify</option>
                </select>
                <hr style="display:block"/>
                <label for="playbackRate" style="display:block">Playback rate:</label>
                <input id="playbackRate" type="number" min="0.1" max="4.0" step="0.1" value="1.0" style="display:block"/> 
                <label for="buttonContinuousPlay">Continuous play:</label>
                <button id="buttonContinuousPlay" style="display:block">OFF</button>
                <label for="buttonTimeFormat" style="display:block">Time format:</label>
                <button id="buttonTimeFormat" style="display:block">DECIMAL</button>
                <label for="transitionOffset" style="display:block">Transition offset (s):</label>
                <input id="transitionOffset" type="number" min="0" max="0.400" step="0.010" value="0.100" style="display:block"/> 
                <hr style="display:block"/>
                <label for="outputFormat" style="display:block">Format:</label>
                <select name="outputFormat" id="outputFormat" style="display:block">
                    <option value="csv">CSV</option>
                    <option value="json" selected="selected">JSON</option>
                    <option value="smil">SMIL</option>
                    <option value="srt">SRT</option>
                    <option value="ssv">SSV</option>
                    <option value="ttml">TTML</option>
                    <option value="tsv">TSV</option>
                    <option value="txt">TXT</option>
                    <option value="vtt">VTT</option>
                    <option value="xml">XML</option>
                </select>
                <input id="smilAudioRef" style="display:none" type="text" placeholder="audio_ref"/>
                <input id="smilPageRef" style="display:none" type="text" placeholder="page_ref"/>
                <button id="download" style="display:block">Save</button>
            </div>

            <div class="footer">
                <a href="https://github.com/ozdefir/finetuneas">finetuneas v1.0.2</a><br/>© 2015 Firat Özdemir 
            </div>
        </div>
        <!-- END container -->

<!-- BEGIN script -->
<script type="text/javascript">
//
//
// global variables and constants
//
//
var fragments = [];
var currentIndex = 0;
var audioElement = document.getElementById("audioplayer");
var ainfo = "";
var cinfo = "";
var url;
var COMPLETED = "lightgreen";
var ACTIVE = "yellow";
var CLEAR = "";
var TRANSITION_TIMEOUT = 0.400;
//
//
// variables that can be modified by the user at runtime
//
//
// do not remove the following lines starting with AENEAS_REPLACE_
//
var timeStep = 0.1;
// AENEAS_REPLACE_TIME_STEP
var showID = false;
showID = true;
var alignText = "center";
alignText = "left"
var playbackRate = 1.0;
// AENEAS_REPLACE_PLAYBACK_RATE
var continuousPlay = false;
continuousPlay = true;
var timeFormatHHMMSSmmm = false;
timeFormatHHMMSSmmm = true;
var transitionOffset = 0.100;
// AENEAS_REPLACE_TRANSITION_OFFSET
var outputFormat = "json";
// AENEAS_REPLACE_OUTPUT_FORMAT
var audioref = "";
// AENEAS_REPLACE_SMIL_AUDIOREF
var pageref = "";
// AENEAS_REPLACE_SMIL_PAGEREF
//
// do not remove the lines above starting with AENEAS_REPLACE_
//
//
// BEGIN INIT CODE
//
//
bindEssentialListeners();
applyDefaults();
//
//
// END INIT CODE
//
//
function bindEssentialListeners() {
    try {
        document.getElementById("audioinput").addEventListener("change", buttonLoadAudio, false);
    } catch(e) {
        // pass
    }
    try {
        document.getElementById("fileinput").addEventListener("change", buttonLoadJSON, false);
    } catch(e) {
        // pass
    }
    try {
        document.getElementById("buttonAutoLoad").addEventListener("click", buttonAutoLoad, false);
    } catch(e) {
        // pass
    }
}
function applyDefaults() {
    try {
        document.getElementById("timeStep").value = timeStep;
        setButtonText("buttonShowID", showID, "ON", "OFF");
        document.getElementById("alignText").value = alignText;
        document.getElementById("playbackRate").value = playbackRate;
        setButtonText("buttonContinuousPlay", continuousPlay, "ON", "OFF");
        setButtonText("buttonTimeFormat", timeFormatHHMMSSmmm, "HH:MM:SS.mmm", "DECIMAL");
        document.getElementById("transitionOffset").value = transitionOffset;
        document.getElementById("outputFormat").value = outputFormat;
        document.getElementById("smilAudioRef").value = audioref;
        document.getElementById("smilPageRef").value = pageref;
        changeOutputFormat();
    } catch(e) {
        // pass
    }
}
function buttonAutoLoad() {
    // fake
    var audioFilePath = "file:///tmp/audio.mp3";
    // do not remove the next line
    audioFilePath = "file:///media/bigdisk/git_repos/trafikmaktordningen-audiobook/original_data/Trafikmaktordningen ljudbok/Trafikmaktordningen - Kapitel 9.mp3";
    // do not remove the line above
    loadAudio(audioFilePath);
   
    // fake
    fragments = [
      {"begin": "0.000",  "end": "2.680",  "id": "f000001", "language": "en", "lines": ["1"]}, 
      {"begin": "2.680",  "end": "5.880",  "id": "f000002", "language": "en", "lines": ["From fairest creatures we desire increase,"]}, 
      {"begin": "5.880",  "end": "9.240",  "id": "f000003", "language": "en", "lines": ["That thereby beauty's rose might never die,"]}, 
      {"begin": "9.240",  "end": "11.760", "id": "f000004", "language": "en", "lines": ["But as the riper should by time decease,"]},
      {"begin": "11.760", "end": "14.440", "id": "f000005", "language": "en", "lines": ["His tender heir might bear his memory:"]},
      {"begin": "14.440", "end": "18.560", "id": "f000006", "language": "en", "lines": ["But thou contracted to thine own bright eyes,"]},
      {"begin": "18.560", "end": "22.280", "id": "f000007", "language": "en", "lines": ["Feed'st thy light's flame with self-substantial fuel,"]},
      {"begin": "22.280", "end": "25.480", "id": "f000008", "language": "en", "lines": ["Making a famine where abundance lies,"]},
      {"begin": "25.480", "end": "31.200", "id": "f000009", "language": "en", "lines": ["Thy self thy foe, to thy sweet self too cruel:"]},
      {"begin": "31.200", "end": "34.400", "id": "f000010", "language": "en", "lines": ["Thou that art now the world's fresh ornament,"]},
      {"begin": "34.400", "end": "36.960", "id": "f000011", "language": "en", "lines": ["And only herald to the gaudy spring,"]},
      {"begin": "36.960", "end": "40.640", "id": "f000012", "language": "en", "lines": ["Within thine own bud buriest thy content,"]},
      {"begin": "40.640", "end": "43.640", "id": "f000013", "language": "en", "lines": ["And tender churl mak'st waste in niggarding:"]},
      {"begin": "43.640", "end": "48.120", "id": "f000014", "language": "en", "lines": ["Pity the world, or else this glutton be,"]},
      {"begin": "48.120", "end": "53.240", "id": "f000015", "language": "en", "lines": ["To eat the world's due, by the grave and thee."]}
    ];
    // do not remove the next line
    fragments = ({
 "fragments": [
  {
   "begin": "0.000", 
   "children": [], 
   "end": "2.720", 
   "id": "f000001", 
   "language": "swe", 
   "lines": [
    "Kapitel 9."
   ]
  }, 
  {
   "begin": "2.720", 
   "children": [], 
   "end": "7.680", 
   "id": "f000002", 
   "language": "swe", 
   "lines": [
    "LIBERALISMENS H\u00d6GSTA STADIUM."
   ]
  }, 
  {
   "begin": "7.680", 
   "children": [], 
   "end": "15.440", 
   "id": "f000003", 
   "language": "swe", 
   "lines": [
    "Vi hatar bilar d\u00e4rf\u00f6r att bilismen har gjort oss till slavar under sitt r\u00f6relsem\u00f6nster."
   ]
  }, 
  {
   "begin": "15.440", 
   "children": [], 
   "end": "26.080", 
   "id": "f000004", 
   "language": "swe", 
   "lines": [
    "Ett liberal-individualistiskt r\u00f6relsem\u00f6nster som tvingar oss att s\u00e4tta prislappar p\u00e5 v\u00e5ra kroppar, v\u00e5rt arbete och p\u00e5 v\u00e5r tid."
   ]
  }, 
  {
   "begin": "26.080", 
   "children": [], 
   "end": "43.040", 
   "id": "f000005", 
   "language": "swe", 
   "lines": [
    "Precis som liberalismen gav oss en helt meningsl\u00f6s valfrihet i utbyte mot trygghet och v\u00e4lf\u00e4rd har bilen gett oss mobilitet p\u00e5 bekostnad av v\u00e5r r\u00f6relsefrihet."
   ]
  }, 
  {
   "begin": "43.040", 
   "children": [], 
   "end": "45.880", 
   "id": "f000006", 
   "language": "swe", 
   "lines": [
    "Vi lever i transport\u00e5ldern."
   ]
  }, 
  {
   "begin": "45.880", 
   "children": [], 
   "end": "53.400", 
   "id": "f000007", 
   "language": "swe", 
   "lines": [
    "Marknaden \u00e4r beroende av st\u00e4ndig r\u00f6relse, och liberalismen best\u00e4mmer politiken:"
   ]
  }, 
  {
   "begin": "53.400", 
   "children": [], 
   "end": "62.480", 
   "id": "f000008", 
   "language": "swe", 
   "lines": [
    "den tvingar oss att vara flexibla, mobila, tvingar oss att vara ensamma individer."
   ]
  }, 
  {
   "begin": "62.480", 
   "children": [], 
   "end": "71.840", 
   "id": "f000009", 
   "language": "swe", 
   "lines": [
    "F\u00f6rst n\u00e4r vi f\u00f6rs\u00f6ker f\u00f6rst\u00e5 och sj\u00e4lva styra denna r\u00f6relse har vi en chans att ta makten \u00f6ver v\u00e5ra liv."
   ]
  }, 
  {
   "begin": "71.840", 
   "children": [], 
   "end": "80.280", 
   "id": "f000010", 
   "language": "swe", 
   "lines": [
    "Det \u00e4r sj\u00e4lvfallet inte bilen i sig som \u00e4r v\u00e5rt st\u00f6rsta hatobjekt, utan det samh\u00e4lle den skapar."
   ]
  }, 
  {
   "begin": "80.280", 
   "children": [], 
   "end": "93.960", 
   "id": "f000011", 
   "language": "swe", 
   "lines": [
    "Men bilen som enskild transportmaskin existerar inte l\u00e4ngre, bilen \u00e4r inte n\u00e5gon tjusig pryl som kan h\u00f6ja v\u00e5r livskvalitet eller \u00f6ka v\u00e5r frihet."
   ]
  }, 
  {
   "begin": "93.960", 
   "children": [], 
   "end": "101.360", 
   "id": "f000012", 
   "language": "swe", 
   "lines": [
    "Med bilen har vi f\u00e5tt massbilismen och alla dess kostnader p\u00e5 k\u00f6pet."
   ]
  }, 
  {
   "begin": "101.360", 
   "children": [], 
   "end": "108.440", 
   "id": "f000013", 
   "language": "swe", 
   "lines": [
    "Massbilismen har kommit att inneb\u00e4ra liberalismens absoluta herrav\u00e4lde \u00f6ver vardagslivet."
   ]
  }, 
  {
   "begin": "108.440", 
   "children": [], 
   "end": "114.520", 
   "id": "f000014", 
   "language": "swe", 
   "lines": [
    "Den har skapat en v\u00e4rld d\u00e4r r\u00f6relse \u00e4r n\u00e5got som m\u00e5ste ske isolerat."
   ]
  }, 
  {
   "begin": "114.520", 
   "children": [], 
   "end": "128.920", 
   "id": "f000015", 
   "language": "swe", 
   "lines": [
    "Men det \u00e4r viktigt att komma ih\u00e5g att f\u00f6rest\u00e4llningen om oss sj\u00e4lva som atom\u00e4ra individer inte \u00e4r n\u00e5got sj\u00e4lvklart, den m\u00e5ste st\u00e4ndigt reproduceras och vidmakth\u00e5llas."
   ]
  }, 
  {
   "begin": "128.920", 
   "children": [], 
   "end": "139.680", 
   "id": "f000016", 
   "language": "swe", 
   "lines": [
    "Bilen \u00e4r det perfekta redskapet f\u00f6r att isolera m\u00e4nniskor fr\u00e5n varandra, f\u00f6r att kontrollera oss och g\u00f6ra oss s\u00e5rbara."
   ]
  }, 
  {
   "begin": "139.680", 
   "children": [], 
   "end": "145.680", 
   "id": "f000017", 
   "language": "swe", 
   "lines": [
    "I bilens v\u00e4rld s\u00f6ker varje f\u00f6rare vinning p\u00e5 andras bekostnad."
   ]
  }, 
  {
   "begin": "145.680", 
   "children": [], 
   "end": "161.440", 
   "id": "f000018", 
   "language": "swe", 
   "lines": [
    "Vi spelar ett nollsummespel d\u00e4r ingen kan vinna utan att n\u00e5gon annan f\u00f6rlorar \u2013 en fortk\u00f6rning h\u00e4r och en omk\u00f6rning d\u00e4r l\u00e5ter n\u00e5gon vinna en minut p\u00e5 bekostnad av n\u00e5gon annans tid..."
   ]
  }, 
  {
   "begin": "161.440", 
   "children": [], 
   "end": "164.040", 
   "id": "f000019", 
   "language": "swe", 
   "lines": [
    "Eller liv."
   ]
  }, 
  {
   "begin": "164.040", 
   "children": [], 
   "end": "180.880", 
   "id": "f000020", 
   "language": "swe", 
   "lines": [
    "Vi lever p\u00e5 2010-talet och \u00e4r medvetna om bilismens alla nackdelar, men \u00e4nd\u00e5 tycks den romantiska illusionen om bilen som frihetssymbol lika glittrande och oantastlig som f\u00f6r 50 \u00e5r sedan."
   ]
  }, 
  {
   "begin": "180.880", 
   "children": [], 
   "end": "192.280", 
   "id": "f000021", 
   "language": "swe", 
   "lines": [
    "Varken alarmerande forskningsrapporter eller deprimerande trafikstockningar har v\u00e5llat bilens varum\u00e4rke n\u00e5gon st\u00f6rre skada."
   ]
  }, 
  {
   "begin": "192.280", 
   "children": [], 
   "end": "195.360", 
   "id": "f000022", 
   "language": "swe", 
   "lines": [
    "Det finns en orsak till det:"
   ]
  }, 
  {
   "begin": "195.360", 
   "children": [], 
   "end": "203.360", 
   "id": "f000023", 
   "language": "swe", 
   "lines": [
    "den liberala ideologin med sitt speciella f\u00f6rh\u00e5llande till frihet och r\u00f6relse."
   ]
  }, 
  {
   "begin": "203.360", 
   "children": [], 
   "end": "213.640", 
   "id": "f000024", 
   "language": "swe", 
   "lines": [
    "I denna bok har vi introducerat begreppet automobilitet i ett f\u00f6rs\u00f6k att ringa in den liberala synen p\u00e5 r\u00f6relse."
   ]
  }, 
  {
   "begin": "213.640", 
   "children": [], 
   "end": "217.560", 
   "id": "f000025", 
   "language": "swe", 
   "lines": [
    "Inneb\u00f6rden blir tydlig i begreppets tv\u00e5 ord:"
   ]
  }, 
  {
   "begin": "217.560", 
   "children": [], 
   "end": "231.520", 
   "id": "f000026", 
   "language": "swe", 
   "lines": [
    "Sj\u00e4lvst\u00e4ndighet (autonomi) uppn\u00e5s genom r\u00f6relse (mobilitet) \u2013 och r\u00f6relse kan bara uppn\u00e5s sj\u00e4lvst\u00e4ndigt."
   ]
  }, 
  {
   "begin": "231.520", 
   "children": [], 
   "end": "237.120", 
   "id": "f000027", 
   "language": "swe", 
   "lines": [
    "Automobiliteten, bilens ideologi, finns inte bara p\u00e5 v\u00e4garna."
   ]
  }, 
  {
   "begin": "237.120", 
   "children": [], 
   "end": "249.880", 
   "id": "f000028", 
   "language": "swe", 
   "lines": [
    "Titta p\u00e5 n\u00e4sta fotg\u00e4ngare som hastar fram fr\u00e5n punkt A till punkt B utan att stanna upp f\u00f6r att uppm\u00e4rksamma sin omgivning eller sina medm\u00e4nniskor."
   ]
  }, 
  {
   "begin": "249.880", 
   "children": [], 
   "end": "255.920", 
   "id": "f000029", 
   "language": "swe", 
   "lines": [
    "Det \u00e4r inte ett m\u00e4nskligt r\u00f6relsem\u00f6nster, fotg\u00e4ngaren beter sig som en bilist!"
   ]
  }, 
  {
   "begin": "255.920", 
   "children": [], 
   "end": "273.320", 
   "id": "f000030", 
   "language": "swe", 
   "lines": [
    "I och med massbilismen har bilen p\u00e5f\u00f6rt sin logik p\u00e5 all samh\u00e4llsplanering, v\u00e5ra st\u00e4der \u00e4r byggda f\u00f6r att omforma alla kroppsliga fl\u00f6den efter bilens r\u00f6relsem\u00f6nster."
   ]
  }, 
  {
   "begin": "273.320", 
   "children": [], 
   "end": "294.160", 
   "id": "f000031", 
   "language": "swe", 
   "lines": [
    "Bilismen har etablerat sig i v\u00e5ra hj\u00e4rnor och d\u00e4rifr\u00e5n styr den v\u00e5ra samh\u00e4llen med en antisocial logik av rationalitet, funktionsuppdelning, hastighet, m\u00e5lmedvetenhet och effektivitet."
   ]
  }, 
  {
   "begin": "294.160", 
   "children": [], 
   "end": "313.240", 
   "id": "f000032", 
   "language": "swe", 
   "lines": [
    "Alla m\u00e5ste anpassa sig efter den starkaste i trafikmaktordningen, och eftersom ingen strukturell hierarki \u00e4r en isolerad f\u00f6reteelse \u00e4r det samma personer som g\u00e5ng p\u00e5 g\u00e5ng finner sig \u00f6verk\u00f6rda av de privilegierade grupperna."
   ]
  }, 
  {
   "begin": "313.240", 
   "children": [], 
   "end": "320.480", 
   "id": "f000033", 
   "language": "swe", 
   "lines": [
    "M\u00f6jligheten till mobilitet \u00e4r t\u00e4tt sammankopplad med klass, k\u00f6n och plats:"
   ]
  }, 
  {
   "begin": "320.480", 
   "children": [], 
   "end": "335.080", 
   "id": "f000034", 
   "language": "swe", 
   "lines": [
    "de som inte har r\u00e5d att k\u00f6pa en bil fr\u00e5ntas r\u00e4tten till mobilitet n\u00e4r samh\u00e4lleliga resurser som kunde ha g\u00e5tt till kollektiva transporter \u00e4ts upp av bilismen."
   ]
  }, 
  {
   "begin": "335.080", 
   "children": [], 
   "end": "340.160", 
   "id": "f000035", 
   "language": "swe", 
   "lines": [
    "I bilsamh\u00e4llet \u00e4r alla andra transportmedel f\u00f6r d\u00e5liga."
   ]
  }, 
  {
   "begin": "340.160", 
   "children": [], 
   "end": "348.240", 
   "id": "f000036", 
   "language": "swe", 
   "lines": [
    "Kollektivtrafik, cykel och g\u00e5ng kan aldrig konkurrera med bilen p\u00e5 bilens villkor."
   ]
  }, 
  {
   "begin": "348.240", 
   "children": [], 
   "end": "364.760", 
   "id": "f000037", 
   "language": "swe", 
   "lines": [
    "Detta f\u00f6rklarar varf\u00f6r bilen fortfarande lyckas beh\u00e5lla sin positiva laddning, trots det djupt paradoxala i att ha en frihetsmaskin som \u00e4r beroende av ett specialdesignat kontrollsamh\u00e4lle."
   ]
  }, 
  {
   "begin": "364.760", 
   "children": [], 
   "end": "370.320", 
   "id": "f000038", 
   "language": "swe", 
   "lines": [
    "N\u00e4r en bil tar upp plats i staden kan ingen annan bil k\u00f6ra d\u00e4r."
   ]
  }, 
  {
   "begin": "370.320", 
   "children": [], 
   "end": "375.680", 
   "id": "f000039", 
   "language": "swe", 
   "lines": [
    "Varje parkerad bil hindrar n\u00e4sta bil fr\u00e5n att parkera."
   ]
  }, 
  {
   "begin": "375.680", 
   "children": [], 
   "end": "386.360", 
   "id": "f000040", 
   "language": "swe", 
   "lines": [
    "N\u00e4r en bilist k\u00f6r f\u00f6r fort m\u00e5ste alla andra anpassa sig och l\u00e4gga extra mycket uppm\u00e4rksamhet p\u00e5 honom f\u00f6r sin egen s\u00e4kerhet."
   ]
  }, 
  {
   "begin": "386.360", 
   "children": [], 
   "end": "391.320", 
   "id": "f000041", 
   "language": "swe", 
   "lines": [
    "1900-talet var ett sekel av anpassning till massbilismen."
   ]
  }, 
  {
   "begin": "391.320", 
   "children": [], 
   "end": "398.360", 
   "id": "f000042", 
   "language": "swe", 
   "lines": [
    "V\u00e5ra st\u00e4der byggdes om fr\u00e5n grunden med m\u00e5let att tillgodose bilismens alla behov:"
   ]
  }, 
  {
   "begin": "398.360", 
   "children": [], 
   "end": "410.760", 
   "id": "f000043", 
   "language": "swe", 
   "lines": [
    "uppbyggnad och utbyggnad av motorv\u00e4gar, parkeringsplatser och trafikregler tog enorma samh\u00e4lleliga resurser i anspr\u00e5k."
   ]
  }, 
  {
   "begin": "410.760", 
   "children": [], 
   "end": "429.400", 
   "id": "f000044", 
   "language": "swe", 
   "lines": [
    "Men varje ny gata generar mer trafik \u00e4n vad den har kapacitet f\u00f6r, varje parkering fylls till bredden och varje ny stadsjeep tvingar andra att k\u00f6pa en \u00e4nnu st\u00f6rre bil f\u00f6r sin egen s\u00e4kerhets skull."
   ]
  }, 
  {
   "begin": "429.400", 
   "children": [], 
   "end": "446.440", 
   "id": "f000045", 
   "language": "swe", 
   "lines": [
    "V\u00e5ra liv och v\u00e5ra m\u00f6jligheter begr\u00e4nsas av det hyperkontrollerade samh\u00e4lle som kr\u00e4vs f\u00f6r att ett transportsystem byggt p\u00e5 individualism och h\u00f6ga hastigheter inte ska kollapsa fullst\u00e4ndigt."
   ]
  }, 
  {
   "begin": "446.440", 
   "children": [], 
   "end": "454.080", 
   "id": "f000046", 
   "language": "swe", 
   "lines": [
    "I bilsamh\u00e4llet har automobiliteten tvingat in oss i ett beroende av sina egna institutioner:"
   ]
  }, 
  {
   "begin": "454.080", 
   "children": [], 
   "end": "475.400", 
   "id": "f000047", 
   "language": "swe", 
   "lines": [
    "bankl\u00e5n f\u00f6r att k\u00f6pa bilar, l\u00e5nga arbetsdagar f\u00f6r att betala omkostnaderna och l\u00e5nen, oljebolag f\u00f6r att tanka, verkst\u00e4der n\u00e4r bilen g\u00e5r s\u00f6nder, stater f\u00f6r att bygga och uppr\u00e4tth\u00e5lla infrastruktur och s\u00e5 vidare i all o\u00e4ndlighet."
   ]
  }, 
  {
   "begin": "475.400", 
   "children": [], 
   "end": "490.720", 
   "id": "f000048", 
   "language": "swe", 
   "lines": [
    "Bilen har gett oss liberalernas dr\u00f6msamh\u00e4lle, d\u00e4r vi \u00e4r tv\u00e5ngsinlagda p\u00e5 den frihetens slutna avdelning som utg\u00f6rs av externa k\u00f6pcentrum och o\u00e4ndliga motorv\u00e4gar."
   ]
  }, 
  {
   "begin": "490.720", 
   "children": [], 
   "end": "511.360", 
   "id": "f000049", 
   "language": "swe", 
   "lines": [
    "Den absurda funktionsseparering som inneb\u00e4r att vi ska bo p\u00e5 ett st\u00e4lle, arbeta p\u00e5 ett annat och roa oss p\u00e5 ett tredje \u00e4r en direkt produkt av bilsamh\u00e4llet, d\u00e4r vi endast med hj\u00e4lp av bilen effektivt kan ta oss mellan dessa platser."
   ]
  }, 
  {
   "begin": "511.360", 
   "children": [], 
   "end": "518.640", 
   "id": "f000050", 
   "language": "swe", 
   "lines": [
    "Vi \u00e5ker bil till gymmet f\u00f6r att staden \u00e4r f\u00f6r f\u00f6rorenad och otrevlig f\u00f6r att motionera i."
   ]
  }, 
  {
   "begin": "518.640", 
   "children": [], 
   "end": "525.920", 
   "id": "f000051", 
   "language": "swe", 
   "lines": [
    "I brist p\u00e5 tid slafsar vi i oss en torftig macka i bilk\u00f6n p\u00e5 v\u00e4g till jobbet."
   ]
  }, 
  {
   "begin": "525.920", 
   "children": [], 
   "end": "541.960", 
   "id": "f000052", 
   "language": "swe", 
   "lines": [
    "Vi arbetar mer och mer f\u00f6r att betala all skit, vilket leder till att vi m\u00e5ste arbeta \u00e4nnu lite mera f\u00f6r att kunna spara pengar och \u00e5ka p\u00e5 semester f\u00f6r att koppla av fr\u00e5n arbetet."
   ]
  }, 
  {
   "begin": "541.960", 
   "children": [], 
   "end": "553.280", 
   "id": "f000053", 
   "language": "swe", 
   "lines": [
    "St\u00e4ndiga krav p\u00e5 h\u00f6gre vinster st\u00e5r i direkt mots\u00e4ttning till meningsfulla saker som kortare arbetstid och levande lokalsamh\u00e4llen."
   ]
  }, 
  {
   "begin": "553.280", 
   "children": [], 
   "end": "572.360", 
   "id": "f000054", 
   "language": "swe", 
   "lines": [
    "V\u00e5rt transportberoende \u00e4r s\u00e5 normaliserat att vi ofta gl\u00f6mmer bort hur absurt och sjukt det \u00e4r, men vi m\u00e5ste faktiskt inte ta bilen till gymmet f\u00f6r att r\u00f6ra p\u00e5 kroppen eller flyga \u00f6ver halva v\u00e4rlden f\u00f6r att koppla av."
   ]
  }, 
  {
   "begin": "572.360", 
   "children": [], 
   "end": "578.520", 
   "id": "f000055", 
   "language": "swe", 
   "lines": [
    "Det finns andra m\u00f6jligheter."
   ]
  }, 
  {
   "begin": "578.520", 
   "children": [], 
   "end": "598.120", 
   "id": "f000056", 
   "language": "swe", 
   "lines": [
    "Det talas ibland om att bilismen leder till ett drive in-samh\u00e4lle, och visst kan vi se tendenser till det n\u00e4r fler och fler samh\u00e4llsfunktioner avgr\u00e4nsas fr\u00e5n varandra och anpassas f\u00f6r att maximera bilens effektivitet."
   ]
  }, 
  {
   "begin": "598.120", 
   "children": [], 
   "end": "604.120", 
   "id": "f000057", 
   "language": "swe", 
   "lines": [
    "Vad det d\u00e4remot talas mindre om \u00e4r den flykt fr\u00e5n samh\u00e4llet som bilen inneb\u00e4r."
   ]
  }, 
  {
   "begin": "604.120", 
   "children": [], 
   "end": "613.600", 
   "id": "f000058", 
   "language": "swe", 
   "lines": [
    "Bilen \u00e4r en privat\u00e4gd st\u00e5lbunker p\u00e5 hjul som skyddar sin f\u00f6rare mot andra m\u00e4nniskor."
   ]
  }, 
  {
   "begin": "613.600", 
   "children": [], 
   "end": "629.840", 
   "id": "f000059", 
   "language": "swe", 
   "lines": [
    "Bilisterna beh\u00f6ver inte g\u00e5 av p\u00e5 samma h\u00e5llplatser, lyssna p\u00e5 andra m\u00e4nniskors samtal, uts\u00e4ttas f\u00f6r deras lukt eller p\u00e5 n\u00e5got som helst s\u00e4tt m\u00e4rka av n\u00e5gon m\u00e4nsklig n\u00e4rvaro."
   ]
  }, 
  {
   "begin": "629.840", 
   "children": [], 
   "end": "634.960", 
   "id": "f000060", 
   "language": "swe", 
   "lines": [
    "F\u00f6rflyttningen i bilen sker helt isolerad."
   ]
  }, 
  {
   "begin": "634.960", 
   "children": [], 
   "end": "636.280", 
   "id": "f000061", 
   "language": "swe", 
   "lines": [
    "Ensam."
   ]
  }, 
  {
   "begin": "636.280", 
   "children": [], 
   "end": "639.280", 
   "id": "f000062", 
   "language": "swe", 
   "lines": [
    "En man per bil."
   ]
  }, 
  {
   "begin": "639.280", 
   "children": [], 
   "end": "647.240", 
   "id": "f000063", 
   "language": "swe", 
   "lines": [
    "Det \u00e4r en m\u00e4rklig frihet, en frihet som f\u00f6der r\u00e4dsla."
   ]
  }, 
  {
   "begin": "647.240", 
   "children": [], 
   "end": "654.440", 
   "id": "f000064", 
   "language": "swe", 
   "lines": [
    "Draget till sin spets blir det som i stadsdelen Kreuzberg i Berlin d\u00e4r billoft har introducerats."
   ]
  }, 
  {
   "begin": "654.440", 
   "children": [], 
   "end": "667.480", 
   "id": "f000065", 
   "language": "swe", 
   "lines": [
    "D\u00e4r har man allts\u00e5 byggt en hiss fr\u00e5n gatan som l\u00e5ter bil\u00e4garen parkera i sin egen hall, trots att l\u00e4genheten ligger i ett flerbostadshus mitt i stan."
   ]
  }, 
  {
   "begin": "667.480", 
   "children": [], 
   "end": "678.560", 
   "id": "f000066", 
   "language": "swe", 
   "lines": [
    "P\u00e5 detta s\u00e4tt g\u00e5r det att undvika varenda sekund ute p\u00e5 gatan, i samh\u00e4llet, d\u00e4r alla andra jobbiga m\u00e4nniskor \u00e4r."
   ]
  }, 
  {
   "begin": "678.560", 
   "children": [], 
   "end": "688.360", 
   "id": "f000067", 
   "language": "swe", 
   "lines": [
    "Vi r\u00f6r oss vidare fr\u00e5n ett drive in-samh\u00e4lle mot en \u00e4nnu mer extrem situation: drive through-samh\u00e4llet."
   ]
  }, 
  {
   "begin": "688.360", 
   "children": [], 
   "end": "691.080", 
   "id": "f000068", 
   "language": "swe", 
   "lines": [
    "Eller g\u00e5r det ens att kalla det f\u00f6r ett samh\u00e4lle?"
   ]
  }, 
  {
   "begin": "691.080", 
   "children": [], 
   "end": "704.880", 
   "id": "f000069", 
   "language": "swe", 
   "lines": [
    "Kanske d\u00f6ljer sig en r\u00e4dsla bakom v\u00e5rt bilhat, f\u00f6r visst \u00e4r det skr\u00e4mmande att inte vara s\u00e4ker p\u00e5 om det som vi lever i kan kallas f\u00f6r samh\u00e4lle."
   ]
  }, 
  {
   "begin": "704.880", 
   "children": [], 
   "end": "712.960", 
   "id": "f000070", 
   "language": "swe", 
   "lines": [
    "Ett samh\u00e4lle t\u00e4nker vi oss som en gemensam plats d\u00e4r var och ens n\u00e4rvaro formar helheten."
   ]
  }, 
  {
   "begin": "712.960", 
   "children": [], 
   "end": "730.680", 
   "id": "f000071", 
   "language": "swe", 
   "lines": [
    "Bilismen med sin individualism krockskadar den sociala v\u00e4v som samh\u00e4llen best\u00e5r av och bygger in helt on\u00f6diga konflikter mellan m\u00e4nniskor som bara f\u00f6rs\u00f6ker leva och \u00f6verleva i sin vardag."
   ]
  }, 
  {
   "begin": "730.680", 
   "children": [], 
   "end": "743.080", 
   "id": "f000072", 
   "language": "swe", 
   "lines": [
    "Ett finger \u00e5t en omk\u00f6rande bilist eller en svordomsharang efter en fotg\u00e4ngare \u00e4r vanligt f\u00f6rekommande bilrelaterade konflikter."
   ]
  }, 
  {
   "begin": "743.080", 
   "children": [], 
   "end": "748.880", 
   "id": "f000073", 
   "language": "swe", 
   "lines": [
    "Otrevligt, javisst, men t\u00e4mligen oskyldigt."
   ]
  }, 
  {
   "begin": "748.880", 
   "children": [], 
   "end": "758.880", 
   "id": "f000074", 
   "language": "swe", 
   "lines": [
    "Ibland g\u00e5r det v\u00e4rre och l\u00f6psedlarna f\u00e5r uppfinna nya ordsammans\u00e4ttningar som PARKERINGSMORD."
   ]
  }, 
  {
   "begin": "758.880", 
   "children": [], 
   "end": "764.360", 
   "id": "f000075", 
   "language": "swe", 
   "lines": [
    "Om vi ska kunna \u00f6verskrida liberalismen s\u00e5 m\u00e5ste vi bek\u00e4mpa bilismen."
   ]
  }, 
  {
   "begin": "764.360", 
   "children": [], 
   "end": "776.520", 
   "id": "f000076", 
   "language": "swe", 
   "lines": [
    "Kollektivisering och organisering \u00e4r liberalers stora skr\u00e4ck och kollektivtrafiken \u00e4r ett kraftfullt vapen mot bilsamh\u00e4llet."
   ]
  }, 
  {
   "begin": "776.520", 
   "children": [], 
   "end": "787.800", 
   "id": "f000077", 
   "language": "swe", 
   "lines": [
    "Bilismen g\u00f6r oss ensamma och isolerade fr\u00e5n varandra; kollektivtrafiken skapar sammanhang och gemenskap."
   ]
  }, 
  {
   "begin": "787.800", 
   "children": [], 
   "end": "802.520", 
   "id": "f000078", 
   "language": "swe", 
   "lines": [
    "Bilismen \u00e4r ett farligt spel d\u00e4r varje ny bilist f\u00f6rs\u00e4mrar f\u00f6r de andra, medan kollektivtrafiken \u00e4r ett gemensamt rum som bara blir b\u00e4ttre ju mer det till\u00e5ts v\u00e4xa."
   ]
  }, 
  {
   "begin": "802.520", 
   "children": [], 
   "end": "809.120", 
   "id": "f000079", 
   "language": "swe", 
   "lines": [
    "N\u00e4r bilismen st\u00e4nger in och kopplar bort s\u00e5 \u00f6ppnar kollektivtrafiken upp och kopplar ihop."
   ]
  }, 
  {
   "begin": "809.120", 
   "children": [], 
   "end": "816.960", 
   "id": "f000080", 
   "language": "swe", 
   "lines": [
    "Vi kan f\u00f6r\u00e4ndra v\u00e5ra samh\u00e4llen i riktning mot ett minskat behov av mobilitet."
   ]
  }, 
  {
   "begin": "816.960", 
   "children": [], 
   "end": "835.360", 
   "id": "f000081", 
   "language": "swe", 
   "lines": [
    "Detta inneb\u00e4r sj\u00e4lvklart inte att vi ska sluta f\u00f6rflytta oss \u2013 bara att det meningsl\u00f6sa, repetitiva resandet m\u00e5ste minska, och att vi b\u00f6r strukturera de resor som g\u00f6rs utifr\u00e5n insikten att vi alla, tillsammans, utg\u00f6r samh\u00e4llet."
   ]
  }, 
  {
   "begin": "835.360", 
   "children": [], 
   "end": "859.400", 
   "id": "f000082", 
   "language": "swe", 
   "lines": [
    "Precis som id\u00e9n om den fria individen med makt att styra \u00f6ver sitt eget \u00f6de \u00e4r en produkt av en viss samh\u00e4llsstruktur, s\u00e5 \u00e4r id\u00e9n om automobilitet beroende av en politik som skapar den, definierar dess gr\u00e4nser och maskerar dess inneboende antagonism."
   ]
  }, 
  {
   "begin": "859.400", 
   "children": [], 
   "end": "863.920", 
   "id": "f000083", 
   "language": "swe", 
   "lines": [
    "N\u00e4mligen att din automobilitet bygger p\u00e5 n\u00e5gon annans immobilitet."
   ]
  }, 
  {
   "begin": "863.920", 
   "children": [], 
   "end": "877.160", 
   "id": "f000084", 
   "language": "swe", 
   "lines": [
    "En bil \u00e4r bara nyckeln till frihet s\u00e5 l\u00e4nge samh\u00e4llet r\u00e4knas bort \u2013 h\u00e4rav alla bilreklamer som utspelar sig p\u00e5 \u00f6de bergsv\u00e4gar."
   ]
  }, 
  {
   "begin": "877.160", 
   "children": [], 
   "end": "899.720", 
   "id": "f000085", 
   "language": "swe", 
   "lines": [
    "Ist\u00e4llet f\u00f6r att bygga om kollektivtrafiken efter bilismens spelregler b\u00f6r vi bygga ut den; ist\u00e4llet f\u00f6r att individualisera den b\u00f6r vi f\u00f6rst\u00e4rka dess funktion som det sociala nav v\u00e5ra liv och i f\u00f6rl\u00e4ngningen v\u00e5rt samh\u00e4lle spinner kring."
   ]
  }, 
  {
   "begin": "899.720", 
   "children": [], 
   "end": "909.080", 
   "id": "f000086", 
   "language": "swe", 
   "lines": [
    "En b\u00f6rjan \u00e4r att inte bara acceptera, utan gladeligen affirmera det kollektiva i kollektivtrafiken."
   ]
  }, 
  {
   "begin": "909.080", 
   "children": [], 
   "end": "921.200", 
   "id": "f000087", 
   "language": "swe", 
   "lines": [
    "Nu f\u00f6r tiden g\u00e5r det inte m\u00e5nga dagar mellan tillf\u00e4llena d\u00e5 n\u00e5gon utropar jagets kris, s\u00e5 vi ropar tillbaka:"
   ]
  }, 
  {
   "begin": "921.200", 
   "children": [], 
   "end": "925.600", 
   "id": "f000088", 
   "language": "swe", 
   "lines": [
    "L\u00e5t oss ta tillf\u00e4llet i akt att elda p\u00e5 dess underg\u00e5ng!"
   ]
  }, 
  {
   "begin": "925.600", 
   "children": [], 
   "end": "932.800", 
   "id": "f000089", 
   "language": "swe", 
   "lines": [
    "Varje bil \u00e4r en isolerad \u00f6, men ingen m\u00e4nniska \u00e4r en \u00f6."
   ]
  }, 
  {
   "begin": "932.800", 
   "children": [], 
   "end": "939.280", 
   "id": "f000090", 
   "language": "swe", 
   "lines": [
    "Vi \u00e4r organiserade, v\u00e5ra hj\u00e4rtan brinner och era bilar ocks\u00e5."
   ]
  }, 
  {
   "begin": "939.280", 
   "children": [], 
   "end": "942.320", 
   "id": "f000091", 
   "language": "swe", 
   "lines": [
    "Danos m\u00e1s gasolina!"
   ]
  }, 
  {
   "begin": "942.320", 
   "children": [], 
   "end": "959.920", 
   "id": "f000092", 
   "language": "swe", 
   "lines": [
    "Du har lyssnat till trafikmaktordningen, en bok skriven av planka punkt nu, utgiven p\u00e5 f\u00f6rlaget Korpen Koloni."
   ]
  }, 
  {
   "begin": "959.920", 
   "children": [], 
   "end": "972.760", 
   "id": "f000093", 
   "language": "swe", 
   "lines": [
    "Precis som sin pappersf\u00f6rlaga \u00e4r denna bok \"kopimi\", vilket inneb\u00e4r att du \u00e4r fri att kopiera, sprida och remixa den hur mycket du vill."
   ]
  }, 
  {
   "begin": "972.760", 
   "children": [], 
   "end": "978.120", 
   "id": "f000094", 
   "language": "swe", 
   "lines": [
    "F\u00f6r mer information g\u00e5 in p\u00e5 www.planka.nu."
   ]
  }, 
  {
   "begin": "978.120", 
   "children": [], 
   "end": "988.840", 
   "id": "f000095", 
   "language": "swe", 
   "lines": [
    "Vill du k\u00f6pa originalutg\u00e5van av boken, kan du g\u00f6ra det p\u00e5 bland annat www.korpen-koloni.se."
   ]
  }
 ]
}).fragments;
    // do not remove the line above
    roundTimeValues();
    prepareTable();
    prepareControls();
}
function buttonLoadAudio(evt) {
    var audioFile = evt.target.files[0];
    if (audioFile) {
        var audioFilePath = URL.createObjectURL(audioFile);
        loadAudio(audioFilePath);
        ainfo = "[Audio file: \"" + audioFile.name + "\"]";
        document.getElementById("fileinfo").innerHTML = ainfo + " " + cinfo;
        document.getElementById("step1").style.display = "none";
    } else {
        alert("Failed to load the audio file.");
    }
}
function loadAudio(audioFilePath) {
    audioElement.setAttribute("src", audioFilePath);
}
function buttonLoadJSON(evt) {
     var jsonFile = evt.target.files[0];
     if (jsonFile) {
        loadJSON(jsonFile);
     } else {
        alert("Failed to load the JSON file.");
     }
}
function loadJSON(jsonFile) {
    var reader = new FileReader();
    reader.onload = function(e) { 
        try {
            fragments = JSON.parse(e.target.result).fragments;
        } catch (e) {
            alert("Unable to parse the given JSON file.");
            return;
        }
        roundTimeValues();
        prepareTable();
        prepareControls();
        cinfo = "[JSON file: \"" + jsonFile.name + "\"]";
        document.getElementById("step2").style.display = "none";
        document.getElementById("fileinfo").innerHTML = ainfo + " " + cinfo;
    }
    reader.readAsText(jsonFile);
}   
function prepareControls() {
    // add event listeners
    for (var i = 0; i < fragments.length; i++) {
        if (showID) {
            document.getElementById(getStringID(i, "id")).addEventListener("click", fragmentClick);
        }
        document.getElementById(getStringID(i, "cell")).addEventListener("click", fragmentClick);
        document.getElementById(getStringID(i, "text")).addEventListener("click", fragmentClick);
        document.getElementById(getStringID(i, "time")).addEventListener("click", fragmentClick);
        document.getElementById(getStringID(i, "increase")).addEventListener("click", increaseClick);
        document.getElementById(getStringID(i, "decrease")).addEventListener("click", decreaseClick);
    }
    document.getElementById("stop").addEventListener("click", stopOverlay);
    document.getElementById("buttonShowID").addEventListener("click", changeShowID);
    document.getElementById("alignText").addEventListener("change", changeAlignText);
    document.getElementById("buttonContinuousPlay").addEventListener("click", changeContinuousPlay);
    document.getElementById("buttonTimeFormat").addEventListener("click", changeTimeFormat);
    document.getElementById("timeStep").addEventListener("change", changeTimeStep);
    document.getElementById("transitionOffset").addEventListener("change", changeTransitionOffset);
    document.getElementById("playbackRate").addEventListener("change", changePlaybackRate);
    document.getElementById("outputFormat").addEventListener("change", changeOutputFormat, false);
    document.getElementById("download").addEventListener("click", downloadClick);
    document.getElementById("advancedcontrols").style.visibility = "visible";
}
function changeShowID() {
    showID = !showID;
    setButtonText("buttonShowID", showID, "ON", "OFF");
    prepareTable();
    prepareControls();
}
function changeAlignText() {
    alignText = document.getElementById("alignText").value;
    applyAlignment();
}
function applyAlignment() {
    for (var i = 0; i < fragments.length; i++) {
        document.getElementById(getStringID(i, "cell")).style.textAlign = alignText;
    }
}
function changeOutputFormat() {
    var outputFormat = document.getElementById("outputFormat").value;
    var disp = "none";
    if (outputFormat == "smil") {
        disp = "block";
    }
    document.getElementById("smilAudioRef").style.display = disp;
    document.getElementById("smilPageRef").style.display = disp;
}
function changeTimeStep() {
    timeStep = parseFloat(document.getElementById("timeStep").value);
}
function changeTransitionOffset() {
    transitionOffset = parseFloat(document.getElementById("transitionOffset").value);
}
function changePlaybackRate() {
    audioElement.playbackRate = parseFloat(document.getElementById("playbackRate").value);
}
function changeContinuousPlay() {
    continuousPlay = !continuousPlay;
    setButtonText("buttonContinuousPlay", continuousPlay, "ON", "OFF");
}
function changeTimeFormat() {
    timeFormatHHMMSSmmm = !timeFormatHHMMSSmmm;
    setButtonText("buttonTimeFormat", timeFormatHHMMSSmmm, "HH:MM:SS.mmm", "DECIMAL");
    updateTime();
}
function setButtonText(element, variable, true_text, false_text) {
    var text = false_text;
    if (variable) {
        text = true_text;
    }
    document.getElementById(element).innerHTML = text;
}
function updateTime(i) {
    if (i == null) {
        for (var i = 0; i < fragments.length; i++) {
            var begin = fragments[i].begin;
            document.getElementById(getStringID(i, "time")).innerHTML =  formatTime(begin);
        }
    } else {
        var begin = fragments[i].begin;
        document.getElementById(getStringID(i, "time")).innerHTML =  formatTime(begin);
    }
}
function formatTime(time_value) {
    if (timeFormatHHMMSSmmm) {
        return timeHHMMSSmmm(time_value, ".");
    }
    return time_value.toFixed(3);
}
function getStringID(i, element) {
    if (element == "id") {
        return ("id" + i);
    }
    if (element == "cell") {
        return ("c" + i);
    }
    if (element == "text") {
        return ("f" + i);
    }
    if (element == "time") {
        return ("t" + i);
    }
    if (element == "increase") {
        return ("t" + i + "inc");
    }
    if (element == "decrease") {
        return ("t" + i + "dec");
    }
    return ("" + i);
}
function getID(idstring) {
    var s = idstring;
    s = s.replace("inc", "");
    s = s.replace("dec", "");
    s = s.replace("id", "");
    s = s.replace("c", "");
    s = s.replace("t", "");
    s = s.replace("f", "");
    return parseInt(s);
}
function roundTimeValues() {
    for (var i = 0; i < fragments.length; i++) {
        fragments[i].begin = roundTimeValue(fragments[i].begin);
        fragments[i].end = roundTimeValue(fragments[i].end);
    }
}
function prepareTable() {
    var rows = [];
    for (var i = 0; i < fragments.length; ++i) {
        var id = fragments[i].id;
        var text = fragments[i].lines.join("<br/>");
        var begin = fragments[i].begin;
        var end = fragments[i].end;
        var row = "";
        row += "<tr>";
        row += "<\/tr>";
        row += "<td><\/td>";
        if (showID) {
            row += '<td id="' + getStringID(i, "id") + '">' + id + '<\/td>';
        }
        row += '<td id="' + getStringID(i, "cell") + '"><a class="text" id="' + getStringID(i, "text") + '">' + text + '<\/a><\/td>';
        row += '<td class="edit">';
        row += '<a class="time" id="' + getStringID(i, "time") + '">' + formatTime(begin) + '<\/a>';
        row += '<a class="increase" id="' + getStringID(i, "increase") + '">+<\/a>';
        row += '<a class="decrease" id="' + getStringID(i, "decrease") + '">−<\/a>';
        row += "<\/td>";
        row += "<\/tr>";
        rows[i] = row;
    }
    var colID = "";
    if (showID) {
        colID = '<col width="100">';
    }
    document.getElementById("tb").innerHTML = '<col width="250px">' + colID + '<col><col width="300px"><tbody>' + rows.join("") + "<\/tbody>";
    applyAlignment();
}
function roundTimeValue(time) {
    return Math.round(time * 1000) / 1000;
}
function highlight(style) {
    try {
        document.getElementById(getStringID(currentIndex, "cell")).style.backgroundColor = style;
    } catch (e) {
        // pass 
    }
}
function fragmentClick(evt) {
    highlight(CLEAR);
    currentIndex = getID(evt.target.id);
    playOverlay(0);
}
function increaseClick(evt) {
    changeTime(evt, timeStep);
}
function decreaseClick(evt) {
    changeTime(evt, -timeStep);
}
function changeTime(evt, step) {
    var i = getID(evt.target.id);
    fragments[i].begin = roundTimeValue(fragments[i].begin + step);
    if (fragments[i].begin < 0) {
        fragments[i].begin = 0.00;
    }
    if (i > 0) {
        fragments[i-1].end = fragments[i].begin;
    }
    updateTime(i);
    highlight(CLEAR);
    currentIndex = i;
    playOverlay(0);
}
function downloadData() {
    var aElement = document.createElement("a");
    aElement.style = "display: none";
    document.body.appendChild(aElement);
    return function (data, fileName) {
        blob = new Blob([data], { type: "octet/stream" }),
        url = window.URL.createObjectURL(blob);
        aElement.href = url;
        aElement.download = fileName;
        aElement.click();
    };
}
function triggerDownload(data, fileName) {
    setTimeout(function() {
        var df = downloadData();
        df(data, fileName);
    }, 500);
    window.URL.revokeObjectURL(url);
}
function downloadClick() {
    var outputFormat = document.getElementById("outputFormat").value;
    var data = null;
    switch(outputFormat) {
        case "csv":
            data = downloadCSV();
            break;
        case "json":
            data = downloadJSON();
            break;
        case "smil":
            data = downloadSMIL();
            break;
        case "srt":
            data = downloadSRT();
            break;
        case "ssv":
            data = downloadSSV();
            break;
        case "ttml":
            data = downloadTTML();
            break;
        case "tsv":
            data = downloadTSV();
            break;
        case "txt":
            data = downloadTXT();
            break;
        case "vtt":
            data = downloadVTT();
            break;
        case "xml":
            data = downloadXML();
            break;
        default:
            data = downloadJSON();
    }
    var message = "The modified " + outputFormat.toUpperCase() + " file will be saved in your default Download directory. Please enter a file name:";
    var suggestedFileName = "tuned." + outputFormat;
    var fileName = prompt(message, suggestedFileName);
    triggerDownload(data, fileName);
}
function downloadCSV() {
    var lines = [];
    for (var i = 0; i < fragments.length; ++i) {
        lines[i] = fragments[i].id + "," + fragments[i].begin + "," + fragments[i].end + ',"' + fragments[i].lines.join(" ") + '"';
    };
    return lines.join("\n");
}
function downloadJSON() {
    var jsonData = {};
    jsonData.fragments = fragments;
    // convert the numbers to strings (as in the original JSON)
    function numberToString(key, value) {
        if (typeof value === "number") {
            value = value.toString();
        }
        return value;
    }
    return JSON.stringify(jsonData, numberToString, " ");
}
function downloadSMIL() {
    var audioref = document.getElementById("smilAudioRef").value;
    var pageref = document.getElementById("smilPageRef").value;
    var lines = [];
    var j = 0;
    lines[j++] = '<smil xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/ns/SMIL" version="3.0">';
    lines[j++] = '  <body>';
    lines[j++] = '    <seq id="s000001" epub:textref="' + pageref + '">';
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = '      <par id="p' + pad(i+1, 6) + '">';
        lines[j++] = '        <text src="' + pageref + '#' + fragments[i].id + '"/>';
        lines[j++] = '        <audio src="' + audioref + '" clipBegin="' + timeSMIL(fragments[i].begin) + '" clipEnd="' + timeSMIL(fragments[i].end)+ '"/>';
        lines[j++] = '      <\/par>';
    };
    lines[j++] = '    <\/seq>';
    lines[j++] = '  <\/body>';
    lines[j++] = '<\/smil>';
    return lines.join("\n");
}
function downloadSRT() {
    var lines = [];
    var j = 0;
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = "" + (i+1);
        lines[j++] = timeSRT(fragments[i].begin) + " --> " + timeSRT(fragments[i].end);
        var f_lines = fragments[i].lines;
        for (var k = 0; k < f_lines.length; ++k) {
            lines[j++] = f_lines[k];
        }
        lines[j++] = ""
    };
    return lines.join("\n") + "\n";
}
function downloadSSV() {
    var lines = [];
    for (var i = 0; i < fragments.length; ++i) {
        lines[i] = fragments[i].begin + " " + fragments[i].end + " " + fragments[i].id + ' "' + fragments[i].lines.join(" ") + '"';
    };
    return lines.join("\n");
}
function downloadTTML() {
    var lines = [];
    var j = 0;
    lines[j++] = "<?xml version='1.0' encoding='UTF-8'?>";
    lines[j++] = '<tt xmlns="http://www.w3.org/ns/ttml" xml:lang="">';
    lines[j++] = '  <body>';
    lines[j++] = '    <div>';
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = '      <p xml:id="' + fragments[i].id + '" begin="' + fragments[i].begin + 's" end="' + fragments[i].end + 's">' + fragments[i].lines.join("<br/>") + '<\/p>';
    };
    lines[j++] = '    <\/div>';
    lines[j++] = '  <\/body>';
    lines[j++] = '<\/tt>';
    return lines.join("\n");
}
function downloadTSV() {
    var lines = [];
    for (var i = 0; i < fragments.length; ++i) {
        lines[i] = fragments[i].begin + "\t" + fragments[i].end + "\t" + fragments[i].id;
    };
    return lines.join("\n");
}
function downloadTXT() {
    var lines = [];
    for (var i = 0; i < fragments.length; ++i) {
        lines[i] = fragments[i].id + " " + fragments[i].begin + " " + fragments[i].end + ' "' + fragments[i].lines.join(" ") + '"';
    };
    return lines.join("\n");
}
function downloadVTT() {
    var lines = [];
    var j = 0;
    lines[j++] = "WEBVTT\n"
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = "" + (i+1);
        lines[j++] = timeVTT(fragments[i].begin) + " --> " + timeVTT(fragments[i].end);
        var f_lines = fragments[i].lines;
        for (var k = 0; k < f_lines.length; ++k) {
            lines[j++] = f_lines[k];
        }
        lines[j++] = ""
    };
    return lines.join("\n") + "\n";
}
function downloadXML() {
    var lines = [];
    var j = 0;
    lines[j++] = "<?xml version='1.0' encoding='UTF-8'?>";
    lines[j++] = '<map>';
    for (var i = 0; i < fragments.length; ++i) {
        lines[j++] = '  <fragment id="' + fragments[i].id + '" begin="' + fragments[i].begin + '" end="' + fragments[i].end + '">';
        var f_lines = fragments[i].lines;
        for (var k = 0; k < f_lines.length; ++k) {
            lines[j++] = '    <line>' + f_lines[k] + '<\/line>';
        }
        lines[j++] = '  <\/fragment>';
    };
    lines[j++] = '<\/map>';
    return lines.join("\n");
}
function pad(num, size) {
    var s = num + "";
    while (s.length < size) {
        s = "0" + s;
    }
    return s;
}
function timeHHMMSSmmm(time_value, decimal_separator) {
    var tmp = parseFloat(time_value);
    var hours = parseInt(Math.floor(tmp / 3600));
    tmp -= (hours * 3600);
    var minutes = parseInt(Math.floor(tmp / 60));
    tmp -= minutes * 60;
    var seconds = parseInt(Math.floor(tmp));
    tmp -= seconds;
    var milliseconds = parseInt(Math.floor(tmp * 1000));
    return pad(hours, 2) + ":" + pad(minutes, 2) + ":" + pad(seconds, 2) + decimal_separator + pad(milliseconds, 3); 
}
function timeSMIL(time_value) { 
    return timeHHMMSSmmm(time_value, ".");
}
function timeSRT(time_value) { 
    return timeHHMMSSmmm(time_value, ",");
}
function timeVTT(time_value) { 
    return timeHHMMSSmmm(time_value, ".");
}
function ticker(cTime){
    
    // TODO ALPE use a global stopwatch object
    
    // "timeupdate" alone isn't accurate enough
    // to pause exactly at the end of the fragment.
    // Another option is to use temporal dimensions
    // for audio source but Chrome doesn't support it with blobs.
    // If in the last TRANSITION_TIMEOUT seconds, calculate the time left,
    // and set a corresponding timeout to pause the fragment.
    if(cTime > fragments[currentIndex].end - TRANSITION_TIMEOUT) {
        // subtract transitionOffset seconds to account for the delay introduced by this code
        var timeLeft = (fragments[currentIndex].end - cTime - transitionOffset) * 1000 / audioElement.playbackRate;
        var index = currentIndex;
        setTimeout(function() {
            // do not perform action if the user
            // jumped to another fragment
            if (index == currentIndex) {
                if (continuousPlay) {
                    playOverlay(1);
                } else {
                    highlight(COMPLETED);
                    stopOverlay();
                }
            }
        }, timeLeft)
    }
    // display current time
    document.getElementById("audioticker").innerHTML = cTime.toFixed(3);
}
function stopOverlay() {
    audioElement.pause();
    document.getElementById("stop").style.display = "none";
}
function playOverlay(inc) {
    highlight(CLEAR);
    if (currentIndex + inc < fragments.length) { 
        currentIndex += inc;
        highlight(ACTIVE);
        audioElement.currentTime = fragments[currentIndex].begin;
        audioElement.play();
        document.getElementById("audiocontrols").style.display = "block";
        document.getElementById("stop").style.display = "inline";
    } else {
        stopOverlay();
    }
}   
</script>
<!-- END script -->

    </body>
</html>
